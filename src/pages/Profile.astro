---
import Layout from '../layouts/Layout.astro';
import Navigation from '../components/shared/Navigation.astro';
import PopularCollections from '../components/PopularCollections.astro';
---

<Layout title="Perfil">
  <Navigation />

  <div class="profile-container">
    <!-- üîπ IZQUIERDA -->
    <aside class="left-section">
      <div class="profile-pic-container">
        <img
          id="profile-pic"
          src="https://ui-avatars.com/api/?name=Usuario&background=72B340&color=fff"
          alt="Usuario"
          class="profile-image"
        />
        <div class="upload-section">
          <input type="file" id="upload-input" accept="image/*" hidden />
          <button id="upload-btn" class="upload-button">Cambiar foto</button>
        </div>
      </div>

      <!-- üî∏ Modal para cambiar foto -->
      <div id="photoModal" class="modal hidden">
        <div class="modal-content">
          <button id="closeModalBtn" class="close-modal">√ó</button>
          <h2>Cambiar foto de perfil</h2>
          <div class="modal-options">
            <button id="upload-file-btn" class="modal-btn">üìÅ Subir desde dispositivo</button>
            <button id="upload-url-btn" class="modal-btn">üåê Usar imagen desde Internet</button>
          </div>
          <form id="urlForm" class="hidden">
            <input type="url" id="imageUrl" placeholder="Pega la URL de la imagen..." />
            <button type="submit" class="modal-btn confirm">Guardar</button>
          </form>
        </div>
      </div>

      <div class="user-info">
        <h2 id="user-name">Cargando...</h2>
        <label for="status-select" class="status-label">Estado:</label>
        <select id="status-select">
          <option value="Online">En l√≠nea</option>
          <option value="Away">Lejos</option>
          <option value="Busy">Ocupado</option>
          <option value="Offline">Desconectado</option>
        </select>

        <div class="user-stats">
          <p id="recipes-stat" style="cursor: pointer;" title="Ver publicaciones">
            Publicaciones <span id="recipes-count">0</span>
          </p>
          <p id="followers-stat" style="cursor: pointer;" title="Ver seguidores">
            Seguidores <span id="followers-count">0</span>
          </p>
          <p id="likes-stat" style="cursor: pointer;" title="Ver likes">
            Likes totales <span id="likes-count">0</span>
          </p>
        </div>

        <div class="user-links">
          <a href="/Blog">Blog</a>
          <a href="/Archives">Archivos</a>
          <a href="/Colecciones">Colecciones</a>
          <button id="go-to-feed" class="feed-btn">Ir al Feed</button>
          <button id="logout-button" class="logout-button">Cerrar sesi√≥n</button>
        </div>
      </div>
    </aside>

    <!-- üîπ CENTRO -->
    <main class="main-section">
      <input 
        type="text" 
        id="profile-search" 
        placeholder="Buscar usuarios..." 
        class="search-input" 
      />
      <div id="profile-search-results" class="search-results hidden"></div>

      <div class="banner">
  <img id="banner-image" src="" alt="Banner" class="banner-image" />
  <button id="change-banner-btn" class="change-banner-btn">üì∑ Cambiar portada</button>
</div>

<!-- Modal para cambiar banner -->
<div id="bannerModal" class="modal hidden">
  <div class="modal-content">
    <button id="closeBannerModalBtn" class="close-modal">√ó</button>
    <h2>Cambiar portada</h2>
    <div class="modal-options">
      <button id="banner-upload-file-btn" class="modal-btn">üìÅ Subir desde dispositivo</button>
      <button id="banner-upload-url-btn" class="modal-btn">üåê Usar imagen desde Internet</button>
    </div>
    <input type="file" id="banner-upload-input" accept="image/*" hidden />
    <form id="bannerUrlForm" class="hidden">
      <input type="url" id="bannerImageUrl" placeholder="Pega la URL de la imagen..." />
      <button type="submit" class="modal-btn confirm">Guardar</button>
    </form>
    <div id="banner-loading" class="loading-indicator hidden">
      <span class="spinner"></span>
      <p>Subiendo imagen...</p>
    </div>
  </div>
  </div>

      <PopularCollections />

      <div class="team-info">
        <h3 class="team">
          Grupos
          <button id="create-group-btn" class="create-group-btn">+ Crear Grupo</button>
        </h3>
        
        <!-- Lista de grupos disponibles -->
        <div id="groups-list" class="groups-list">
          <!-- Se llenar√° din√°micamente -->
        </div>

        <!-- Grupo predeterminado FOOD EMOTIONS TEAM -->
        <div class="team-card">
          <h4>FOOD EMOTIONS TEAM</h4>
          <p>Comunidad de desarrolladores creativos</p>
          <p><span id="team-members-count">1,234</span> miembros</p>
          <button id="join-team-button" class="team-action-btn" data-joined="false">üë• Unirse al grupo</button>
        </div>
      </div>

      <!-- Modal para crear grupo -->
      <div id="createGroupModal" class="modal hidden">
        <div class="modal-content">
          <button class="close-modal" onclick="document.getElementById('createGroupModal').classList.add('hidden')">√ó</button>
          <h2>Crear nuevo grupo</h2>
          <form id="create-group-form">
            <div class="form-group">
              <label for="group-name">Nombre del grupo *</label>
              <input type="text" id="group-name" required placeholder="Ej: Amantes de la Cocina" />
            </div>
            <div class="form-group">
              <label for="group-description">Descripci√≥n</label>
              <textarea id="group-description" rows="3" placeholder="Describe de qu√© trata tu grupo..."></textarea>
            </div>
            <div class="form-group">
              <label for="group-image">Imagen del grupo</label>
              <div class="image-upload-container">
                <input type="file" id="group-image-file" accept="image/*" hidden />
                <button type="button" class="image-preview-btn" id="select-group-image">
                  <span id="image-preview-text">üì∑ Seleccionar imagen</span>
                  <img id="group-image-preview" class="hidden" alt="Preview" />
                </button>
              </div>
            </div>
            <button type="submit" class="modal-btn confirm">Crear grupo</button>
          </form>
        </div>
      </div>

      <!-- Modal de detalles del grupo -->
      <div id="groupDetailsModal" class="modal hidden">
        <div class="modal-content group-details-modal">
          <button class="close-modal" onclick="document.getElementById('groupDetailsModal').classList.add('hidden')">√ó</button>
          <div id="group-details-content">
            <!-- Se llenar√° din√°micamente -->
          </div>
        </div>
      </div>
    </main>

    <!-- üîπ DERECHA -->
    <aside class="right-section">
      <!-- ‚úÖ Componente Bibliography Din√°mico -->
      <div class="bibliography-card">
        <div class="bio-header">
          <h3>üìñ Biograf√≠a</h3>
        </div>
        <div class="bio-content" id="bio-display">
          <p id="bio-text">Descripci√≥n no disponible</p>
        </div>
        <div class="bio-footer">
          <div class="bio-meta">
            <span class="bio-icon">üåê</span>
            <a href="https://www.youtube.com/watch?v=b1DC4TxeSdE" target="_blank" id="bio-website">youtube.com/@QueVivaLaCocina</a>
          </div>
          <div class="bio-skills" id="bio-skills">
            <!-- Se llenar√° din√°micamente -->
          </div>
        </div>
      </div>
      
      <textarea
        id="bio-editor"
        class="bio-editor"
        placeholder="Escribe tu biograf√≠a aqu√≠..."
      ></textarea>
      <button id="save-bio-btn" class="save-bio-btn">Guardar biograf√≠a</button>
    </aside>
  </div>

  <!-- Modal de Publicaciones -->
  <div id="postsModal" class="modal hidden">
    <div class="modal-content">
      <button class="close-modal" onclick="document.getElementById('postsModal').classList.add('hidden')">√ó</button>
      <h2>Publicaciones</h2>
      <div id="postsList" class="posts-list"></div>
    </div>
  </div>

  <!-- Modal de Seguidores -->
  <div id="followersModal" class="modal hidden">
    <div class="modal-content">
      <button class="close-modal" onclick="document.getElementById('followersModal').classList.add('hidden')">√ó</button>
      <h2>Seguidores</h2>
      <div id="followersList" class="followers-list"></div>
    </div>
  </div>

  <!-- Modal de Likes -->
  <div id="likesModal" class="modal hidden">
    <div class="modal-content">
      <button class="close-modal" onclick="document.getElementById('likesModal').classList.add('hidden')">√ó</button>
      <h2>Publicaciones con Like</h2>
      <div id="likesList" class="likes-list"></div>
    </div>
  </div>

  <div id="notification" class="notification hidden"></div>
</Layout>

<script>
// ============================================================
// üéØ PROFILE.ASTRO - VERSI√ìN COMPLETA CORREGIDA
// ============================================================

let currentUser = null;
let viewedUser = null;
let isOwner = true;

// ============================================================
// üîî Mostrar notificaci√≥n flotante
// ============================================================
function showNotification(message, type = 'success') {
  const notification = document.getElementById('notification');
  notification.textContent = message;
  notification.className = `notification ${type}`;
  notification.classList.remove('hidden');
  setTimeout(() => notification.classList.add('hidden'), 3000);
}

// ============================================================
// üß© Cargar datos del perfil
// ============================================================
async function loadProfileData() {
  try {
    console.log('üîÑ Cargando perfil del usuario...');
    const meRes = await fetch('http://localhost:3000/api/user/me', {
      credentials: 'include',
      headers: { Accept: 'application/json' },
    });

    if (!meRes.ok) {
      if (meRes.status === 401) return (window.location.href = '/login');
      throw new Error('Error obteniendo usuario logeado');
    }

    const me = await meRes.json();
    
    if (!me.loggedIn) {
      window.location.href = '/login';
      return;
    }
    
    currentUser = me;

    const params = new URLSearchParams(window.location.search);
    const userParam = params.get('user');

    if (userParam && userParam !== me._id) {
      isOwner = false;
      const res = await fetch(`http://localhost:3000/api/users/${userParam}/profile`, {
        credentials: 'include',
        headers: { Accept: 'application/json' },
      });
      if (!res.ok) {
        showNotification('Usuario no encontrado', 'error');
        window.location.href = '/Profile';
        return;
      }
      viewedUser = await res.json();
    } else {
      viewedUser = me;
    }

    updateProfileUI(viewedUser);
    adjustPermissions();
    
    console.log('‚úÖ Perfil cargado correctamente');
  } catch (error) {
    console.error('‚ùå Error cargando perfil:', error);
    showNotification('Error al cargar el perfil', 'error');
  }
}

// ============================================================
// üé® Actualizar UI con datos del usuario cargado
// ============================================================
function updateProfileUI(user) {
  const stats = user.stats || {};
  
  const userName = document.getElementById('user-name');
  const profilePic = document.getElementById('profile-pic');
  const bioEditor = document.getElementById('bio-editor');
  const bioText = document.getElementById('bio-text');
  const recipesCount = document.getElementById('recipes-count');
  const followersCount = document.getElementById('followers-count');
  const likesCount = document.getElementById('likes-count');
  const bannerImage = document.getElementById('banner-image');
  const statusSelect = document.getElementById('status-select');
  
  if (userName) userName.textContent = user.username || 'Usuario';
  
  if (profilePic) {
    profilePic.src = user.profilePic ||
      `https://ui-avatars.com/api/?name=${encodeURIComponent(user.username)}&background=72B340&color=fff`;
  }
  
  // ‚úÖ Actualizar biograf√≠a din√°micamente
  const bioContent = user.bio || 'Sin biograf√≠a disponible';
  if (bioEditor) bioEditor.value = bioContent;
  if (bioText) {
    bioText.textContent = bioContent;
    bioText.style.fontStyle = user.bio ? 'normal' : 'italic';
    bioText.style.color = user.bio ? 'var(--text-light)' : '#999';
  }
  
  if (recipesCount) recipesCount.textContent = stats.posts || 0;
  if (followersCount) followersCount.textContent = stats.followers || 0;
  if (likesCount) likesCount.textContent = stats.totalLikes || 0;
  
  // ‚úÖ Actualizar banner desde Cloudinary
  if (bannerImage && user.bannerImage) {
    bannerImage.src = user.bannerImage;
  }
  
  if (isOwner && statusSelect && user.status) {
    statusSelect.value = user.status;
  }
  
  console.log('‚úÖ UI actualizada con stats:', stats);
}

// ============================================================
// üîê Ajustar visibilidad seg√∫n si es el due√±o
// ============================================================
function adjustPermissions() {
  const userLinks = document.querySelector('.user-links');
  const changeBannerBtn = document.getElementById('change-banner-btn');

  if (!isOwner) {
    console.log('üëÄ Modo visitante activado');

    const hideSelectors = [
      '#upload-btn',
      '#save-bio-btn',
      '#logout-button',
      '#status-select',
      '.status-label',
      '#bio-editor',
      '.upload-section',
      '#change-banner-btn',
    ];

    hideSelectors.forEach(sel => {
      const el = document.querySelector(sel);
      if (el) el.style.display = 'none';
    });

    const followBtn = document.createElement('button');
    followBtn.id = 'follow-btn';
    followBtn.textContent = viewedUser.alreadyFollowing ? '‚úì Siguiendo' : 'üë• Seguir';
    followBtn.className = 'feed-btn';
    followBtn.style.background = viewedUser.alreadyFollowing 
      ? 'linear-gradient(90deg, #7b8e62, #a0b38b)' 
      : 'linear-gradient(90deg, var(--primary), var(--accent))';

    followBtn.addEventListener('click', async () => {
      try {
        const res = await fetch(
          `http://localhost:3000/api/users/${viewedUser._id}/follow`,
          {
            method: 'POST',
            credentials: 'include',
            headers: { 'Content-Type': 'application/json' },
          }
        );

        if (!res.ok) throw new Error('Error al seguir');

        const data = await res.json();
        const isFollowing = data.following;

        followBtn.textContent = isFollowing ? '‚úì Siguiendo' : 'üë• Seguir';
        followBtn.style.background = isFollowing
          ? 'linear-gradient(90deg, #7b8e62, #a0b38b)'
          : 'linear-gradient(90deg, var(--primary), var(--accent))';

        document.getElementById('followers-count').textContent = data.followersCount;
        
        showNotification(data.message, 'success');
      } catch (err) {
        console.error('‚ùå Error:', err);
        showNotification('Error al seguir usuario', 'error');
      }
    });
    userLinks.insertBefore(followBtn, userLinks.firstChild);

    const chatBtn = document.createElement('button');
    chatBtn.textContent = 'üí¨ Enviar mensaje';
    chatBtn.className = 'feed-btn';
    chatBtn.addEventListener('click', () => {
      window.location.href = `/Messages?user=${viewedUser._id}`;
    });
    userLinks.insertBefore(chatBtn, userLinks.children[1]);
  } else {
    console.log('‚úÖ Modo propietario activado');
    if (changeBannerBtn) {
      changeBannerBtn.style.display = 'flex';
    }
  }
}

// ============================================================
// üí¨ Cambiar estado del usuario
// ============================================================
document.getElementById('status-select')?.addEventListener('change', async e => {
  try {
    const newStatus = e.target.value;
    const res = await fetch('http://localhost:3000/profile/status', {
      method: 'PUT',
      credentials: 'include',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ status: newStatus }),
    });
    if (!res.ok) throw new Error('Error al cambiar estado');
    showNotification('Estado actualizado correctamente');
  } catch (err) {
    console.error('‚ùå', err);
    showNotification('Error al cambiar estado', 'error');
  }
});

// ============================================================
// ‚úçÔ∏è Guardar biograf√≠a
// ============================================================
document.getElementById('save-bio-btn')?.addEventListener('click', async () => {
  try {
    const newBio = document.getElementById('bio-editor').value.trim();
    
    if (newBio.length > 500) {
      showNotification('La biograf√≠a no puede superar 500 caracteres', 'error');
      return;
    }
    
    const res = await fetch('http://localhost:3000/api/users/me/bio', {
      method: 'PUT',
      credentials: 'include',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ bio: newBio }),
    });
    
    if (!res.ok) throw new Error('Error al guardar bio');
    
    const data = await res.json();
    
    // ‚úÖ Actualizar biograf√≠a din√°micamente
    const bioText = document.getElementById('bio-text');
    const bioEditor = document.getElementById('bio-editor');
    
    if (bioEditor) bioEditor.value = data.bio || '';
    if (bioText) {
      bioText.textContent = data.bio || 'Sin biograf√≠a disponible';
      bioText.style.fontStyle = data.bio ? 'normal' : 'italic';
      bioText.style.color = data.bio ? 'var(--text-light)' : '#999';
      
      // Animaci√≥n de actualizaci√≥n
      bioText.style.animation = 'pulse 0.5s ease';
      setTimeout(() => {
        bioText.style.animation = '';
      }, 500);
    }
    
    if (currentUser) currentUser.bio = data.bio;
    if (viewedUser) viewedUser.bio = data.bio;
    
    showNotification('Biograf√≠a actualizada correctamente');
  } catch (err) {
    console.error('‚ùå', err);
    showNotification('Error al guardar biograf√≠a', 'error');
  }
});

// ============================================================
// üñºÔ∏è Modal de cambio de foto
// ============================================================
const photoModal = document.getElementById('photoModal');
const uploadBtn = document.getElementById('upload-btn');
const closeModalBtn = document.getElementById('closeModalBtn');
const uploadFileBtn = document.getElementById('upload-file-btn');
const uploadUrlBtn = document.getElementById('upload-url-btn');
const uploadInput = document.getElementById('upload-input');
const urlForm = document.getElementById('urlForm');

uploadBtn?.addEventListener('click', () => photoModal?.classList.remove('hidden'));
closeModalBtn?.addEventListener('click', () => {
  photoModal?.classList.add('hidden');
  urlForm?.classList.add('hidden');
  document.getElementById('imageUrl').value = '';
});
uploadFileBtn?.addEventListener('click', () => uploadInput?.click());
uploadUrlBtn?.addEventListener('click', () => urlForm?.classList.remove('hidden'));

// ============================================================
// üé® IM√ÅGENES ALEATORIAS POR DEFECTO
// ============================================================
const DEFAULT_BANNERS = [
  'https://images.unsplash.com/photo-1557683316-973673baf926?w=1200&h=400&fit=crop',
  'https://images.unsplash.com/photo-1579546929518-9e396f3cc809?w=1200&h=400&fit=crop',
  'https://images.unsplash.com/photo-1557682250-33bd709cbe85?w=1200&h=400&fit=crop',
  'https://images.unsplash.com/photo-1558591710-4b4a1ae0f04d?w=1200&h=400&fit=crop',
  'https://images.unsplash.com/photo-1557682224-5b8590cd9ec5?w=1200&h=400&fit=crop',
  'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=1200&h=400&fit=crop',
  'https://images.unsplash.com/photo-1557682268-e3955ed5d83f?w=1200&h=400&fit=crop',
  'https://images.unsplash.com/photo-1519681393784-d120267933ba?w=1200&h=400&fit=crop',
  'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1200&h=400&fit=crop',
  'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=1200&h=400&fit=crop'
];

// Funci√≥n para obtener imagen aleatoria
function getRandomBanner() {
  const randomIndex = Math.floor(Math.random() * DEFAULT_BANNERS.length);
  return DEFAULT_BANNERS[randomIndex];
}

// ============================================================
// üé® CARGAR BANNER DEL USUARIO O ALEATORIO
// ============================================================
const API_URL = 'http://localhost:3000';
const bannerImage = document.getElementById('banner-image');

async function loadUserBanner() {
  try {
    const res = await fetch(`${API_URL}/api/user/me`, {
      credentials: 'include'
    });

    if (!res.ok) throw new Error('No se pudo cargar el usuario');

    const user = await res.json();
    
    // Si el usuario tiene banner, usarlo; si no, imagen aleatoria
    // Tu backend usa 'bannerImage' como campo
    if (user.bannerImage) {
      bannerImage.src = user.bannerImage;
      console.log('‚úÖ Banner del usuario cargado:', user.bannerImage);
    } else {
      bannerImage.src = getRandomBanner();
      console.log('üé≤ Banner aleatorio asignado');
    }

  } catch (error) {
    console.error('‚ùå Error cargando banner:', error);
    // Si hay error, usar imagen aleatoria
    bannerImage.src = getRandomBanner();
  }
}

// Cargar banner al iniciar
loadUserBanner();

// ============================================================
// üé® Modal de cambio de banner/portada
// ============================================================
const bannerModal = document.getElementById('bannerModal');
const changeBannerBtn = document.getElementById('change-banner-btn');
const closeBannerModalBtn = document.getElementById('closeBannerModalBtn');
const bannerUploadFileBtn = document.getElementById('banner-upload-file-btn');
const bannerUploadUrlBtn = document.getElementById('banner-upload-url-btn');
const bannerUploadInput = document.getElementById('banner-upload-input');
const bannerUrlForm = document.getElementById('bannerUrlForm');
const bannerLoading = document.getElementById('banner-loading');

// Abrir modal
changeBannerBtn?.addEventListener('click', () => {
  bannerModal?.classList.remove('hidden');
  bannerUrlForm?.classList.add('hidden');
});

// Cerrar modal
closeBannerModalBtn?.addEventListener('click', () => {
  bannerModal?.classList.add('hidden');
  bannerUrlForm?.classList.add('hidden');
  document.getElementById('bannerImageUrl').value = '';
});

// Cerrar modal al hacer clic fuera
bannerModal?.addEventListener('click', (e) => {
  if (e.target === bannerModal) {
    bannerModal.classList.add('hidden');
    bannerUrlForm?.classList.add('hidden');
  }
});

// ============================================================
// üìÅ SUBIR DESDE DISPOSITIVO
// ============================================================
bannerUploadFileBtn?.addEventListener('click', () => bannerUploadInput?.click());

bannerUploadInput?.addEventListener('change', async (e) => {
  const file = e.target.files[0];
  if (!file) return;

  // Validar que sea una imagen
  if (!file.type.startsWith('image/')) {
    showToast('‚ùå Por favor selecciona una imagen v√°lida', 'error');
    return;
  }

  // Validar tama√±o (m√°ximo 5MB)
  if (file.size > 5 * 1024 * 1024) {
    showToast('‚ùå La imagen no debe superar 5MB', 'error');
    return;
  }

  try {
    // Mostrar loading
    bannerLoading?.classList.remove('hidden');
    
    // Crear FormData con el nombre correcto del campo
    const formData = new FormData();
    formData.append('bannerImage', file); // ‚Üê Tu backend espera 'bannerImage'

    // Subir imagen
    const uploadRes = await fetch(`${API_URL}/api/users/me/banner`, {
      method: 'POST',
      credentials: 'include',
      body: formData
    });

    if (!uploadRes.ok) throw new Error('Error al subir imagen');

    const uploadData = await uploadRes.json();
    
    console.log('‚úÖ Imagen subida:', uploadData);

    // Actualizar la imagen en el DOM inmediatamente
    // Tu backend retorna 'bannerImage'
    if (uploadData.bannerImage) {
      bannerImage.src = uploadData.bannerImage;
    }

    // Ocultar loading y modal
    bannerLoading?.classList.add('hidden');
    bannerModal?.classList.add('hidden');
    
    showToast('‚úÖ Portada actualizada correctamente', 'success');
    
    // Recargar datos del usuario para confirmar
    await loadUserBanner();

  } catch (error) {
    console.error('‚ùå Error:', error);
    bannerLoading?.classList.add('hidden');
    showToast('‚ùå Error al subir la imagen', 'error');
  }

  // Limpiar input
  e.target.value = '';
});

// ============================================================
// üåê USAR URL DE INTERNET
// ============================================================
bannerUploadUrlBtn?.addEventListener('click', () => {
  bannerUrlForm?.classList.remove('hidden');
});

bannerUrlForm?.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const imageUrl = document.getElementById('bannerImageUrl').value.trim();
  
  if (!imageUrl) {
    showToast('‚ùå Por favor ingresa una URL v√°lida', 'error');
    return;
  }

  // Validar que sea una URL v√°lida
  try {
    new URL(imageUrl);
  } catch {
    showToast('‚ùå URL no v√°lida', 'error');
    return;
  }

  try {
    // Mostrar loading
    bannerLoading?.classList.remove('hidden');

    // Actualizar URL del banner - Tu backend espera 'imageUrl'
    const res = await fetch(`${API_URL}/api/users/me/banner-url`, {
      method: 'PUT',
      credentials: 'include',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ imageUrl: imageUrl })
    });

    if (!res.ok) throw new Error('Error al actualizar banner');

    const data = await res.json();
    console.log('‚úÖ Banner actualizado:', data);

    // Actualizar imagen en el DOM - Tu backend retorna 'bannerImage'
    if (data.bannerImage) {
      bannerImage.src = data.bannerImage;
    } else {
      bannerImage.src = imageUrl;
    }

    // Ocultar loading y modal
    bannerLoading?.classList.add('hidden');
    bannerModal?.classList.add('hidden');
    bannerUrlForm?.classList.add('hidden');
    document.getElementById('bannerImageUrl').value = '';

    showToast('‚úÖ Portada actualizada correctamente', 'success');

  } catch (error) {
    console.error('‚ùå Error:', error);
    bannerLoading?.classList.add('hidden');
    showToast('‚ùå Error al actualizar la portada', 'error');
  }
});

// ============================================================
// üçû SISTEMA DE NOTIFICACIONES TOAST
// ============================================================
function showToast(message, type = 'success') {
  // Remover toasts anteriores
  const existingToasts = document.querySelectorAll('.toast');
  existingToasts.forEach(toast => toast.remove());

  const toast = document.createElement('div');
  toast.className = `toast toast-${type}`;
  toast.textContent = message;
  document.body.appendChild(toast);
  
  setTimeout(() => toast.classList.add('show'), 10);
  setTimeout(() => {
    toast.classList.remove('show');
    setTimeout(() => toast.remove(), 300);
  }, 3000);
}

// ‚úÖ Subir archivo de perfil con validaci√≥n
uploadInput?.addEventListener('change', async e => {
  const file = e.target.files[0];
  if (!file) return;
  
  const allowedTypes = ['image/jpeg', 'image/png', 'image/jpg', 'image/webp'];
  if (!allowedTypes.includes(file.type)) {
    showNotification('Solo se permiten im√°genes (JPG, PNG, WEBP)', 'error');
    return;
  }
  
  if (file.size > 5 * 1024 * 1024) {
    showNotification('La imagen no debe superar 5MB', 'error');
    return;
  }
  
  try {
    const formData = new FormData();
    formData.append('profilePic', file);
    const res = await fetch('http://localhost:3000/profile/upload', {
      method: 'POST',
      credentials: 'include',
      body: formData,
    });
    if (!res.ok) throw new Error('Error al subir imagen');
    const data = await res.json();
    document.getElementById('profile-pic').src = data.profilePic;
    showNotification('Foto de perfil actualizada');
    photoModal?.classList.add('hidden');
    uploadInput.value = '';
  } catch (err) {
    console.error('‚ùå', err);
    showNotification('Error al subir imagen', 'error');
  }
});

// ‚úÖ Guardar URL de foto de perfil
urlForm?.addEventListener('submit', async e => {
  e.preventDefault();
  const imageUrl = document.getElementById('imageUrl').value.trim();
  
  if (!imageUrl) {
    return showNotification('URL inv√°lida', 'error');
  }

  try {
    new URL(imageUrl);
    
    const res = await fetch('http://localhost:3000/profile/update-pic-url', {
      method: 'PUT',
      credentials: 'include',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ imageUrl }),
    });

    if (!res.ok) throw new Error('Error al actualizar foto');
    
    const data = await res.json();
    document.getElementById('profile-pic').src = data.profilePic;
    photoModal?.classList.add('hidden');
    urlForm?.classList.add('hidden');
    document.getElementById('imageUrl').value = '';
    showNotification('Foto actualizada correctamente');
  } catch (err) {
    console.error('‚ùå', err);
    showNotification('URL inv√°lida o error al actualizar', 'error');
  }
});

// ============================================================
// üé® Subir banner desde archivo (CON CLOUDINARY)
// ============================================================
bannerUploadInput?.addEventListener('change', async e => {
  const file = e.target.files[0];
  if (!file) return;
  
  const allowedTypes = ['image/jpeg', 'image/png', 'image/jpg', 'image/webp'];
  if (!allowedTypes.includes(file.type)) {
    showNotification('Solo se permiten im√°genes (JPG, PNG, WEBP)', 'error');
    return;
  }
  
  if (file.size > 5 * 1024 * 1024) {
    showNotification('La imagen no debe superar 5MB', 'error');
    return;
  }
  
  try {
    showNotification('Subiendo portada...', 'success');
    
    const formData = new FormData();
    formData.append('bannerImage', file);
    
    const res = await fetch('http://localhost:3000/api/users/me/banner', {
      method: 'POST',
      credentials: 'include',
      body: formData,
    });
    
    if (!res.ok) throw new Error('Error al subir banner');
    
    const data = await res.json();
    
    document.getElementById('banner-image').src = data.bannerImage;
    
    showNotification('Portada actualizada y guardada');
    bannerModal?.classList.add('hidden');
    bannerUploadInput.value = '';
  } catch (err) {
    console.error('‚ùå', err);
    showNotification('Error al subir portada', 'error');
  }
});

// ============================================================
// üé® Cambiar banner desde URL (CON CLOUDINARY)
// ============================================================
bannerUrlForm?.addEventListener('submit', async e => {
  e.preventDefault();
  const imageUrl = document.getElementById('bannerImageUrl').value.trim();
  
  if (!imageUrl) {
    return showNotification('URL inv√°lida', 'error');
  }

  try {
    new URL(imageUrl);
    
    showNotification('Guardando portada...', 'success');
    
    const res = await fetch('http://localhost:3000/api/users/me/banner-url', {
      method: 'PUT',
      credentials: 'include',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ imageUrl }),
    });

    if (!res.ok) throw new Error('Error al actualizar portada');
    
    const data = await res.json();
    
    document.getElementById('banner-image').src = data.bannerImage;
    
    bannerModal?.classList.add('hidden');
    bannerUrlForm?.classList.add('hidden');
    document.getElementById('bannerImageUrl').value = '';
    showNotification('Portada actualizada y guardada');
  } catch (err) {
    console.error('‚ùå', err);
    showNotification('URL inv√°lida o error al actualizar', 'error');
  }
});

// ============================================================
// üîç Buscar usuarios desde el perfil
// ============================================================
let searchTimeout;
const profileSearch = document.getElementById('profile-search');
const profileSearchResults = document.getElementById('profile-search-results');

profileSearch?.addEventListener('input', e => {
  clearTimeout(searchTimeout);
  const query = e.target.value.trim();
  
  if (query.length < 2) {
    profileSearchResults.innerHTML = '';
    profileSearchResults.classList.add('hidden');
    return;
  }
  
  searchTimeout = setTimeout(async () => {
    try {
      const res = await fetch(
        `http://localhost:3000/api/users/search?q=${encodeURIComponent(query)}`,
        { credentials: 'include' }
      );
      if (!res.ok) throw new Error('Error en b√∫squeda');
      const users = await res.json();
      profileSearchResults.innerHTML =
        users.length === 0
          ? '<div class="no-results">No se encontraron usuarios</div>'
          : users
              .map(
                u => `
              <div class="search-result-item" data-user-id="${u._id}">
                <img src="${u.profilePic || `https://ui-avatars.com/api/?name=${encodeURIComponent(u.username)}`}" alt="${u.username}" />
                <div>
                  <strong>${u.username}</strong>
                  <p>${u.email || ''}</p>
                </div>
              </div>`
              )
              .join('');
      document.querySelectorAll('.search-result-item').forEach(item => {
        item.addEventListener('click', () => {
          window.location.href = `/Profile?user=${item.dataset.userId}`;
        });
      });
      profileSearchResults.classList.remove('hidden');
    } catch (err) {
      console.error('‚ùå Error en b√∫squeda:', err);
      showNotification('Error al buscar usuarios', 'error');
    }
  }, 300);
});

// ============================================================
// üîÑ Refrescar estad√≠sticas del perfil
// ============================================================
async function refreshProfileStats() {
  try {
    const res = await fetch(`http://localhost:3000/api/users/${viewedUser._id}/profile`, {
      credentials: 'include',
      headers: { Accept: 'application/json' },
    });
    
    if (!res.ok) return;
    
    const data = await res.json();
    const stats = data.stats || {};
    
    document.getElementById('recipes-count').textContent = stats.posts || 0;
    document.getElementById('followers-count').textContent = stats.followers || 0;
    document.getElementById('likes-count').textContent = stats.totalLikes || 0;
    
    console.log('‚úÖ Estad√≠sticas actualizadas');
  } catch (err) {
    console.error('‚ùå Error actualizando estad√≠sticas:', err);
  }
}

// ============================================================
// üìä Ver publicaciones del usuario
// ============================================================
document.getElementById('recipes-stat')?.addEventListener('click', async () => {
  if (!viewedUser) return;
  try {
    await refreshProfileStats();
    
    const res = await fetch(`http://localhost:3000/api/users/${viewedUser._id}/posts`, {
      credentials: 'include',
    });
    
    if (!res.ok) throw new Error('Error al obtener publicaciones');
    
    const posts = await res.json();
    const postsList = document.getElementById('postsList');
    postsList.innerHTML =
      posts.length > 0
        ? posts
            .map(
              p => `
          <div class="post-item" onclick="window.location.href='/Social?post=${p._id}'">
            ${p.images?.[0] ? `<img src="${p.images[0]}" alt="Post" />` : '<div class="no-image">üìù</div>'}
            <div>
              <p>${p.caption || 'Sin descripci√≥n'}</p>
              <div class="post-stats">
                <span>‚ù§Ô∏è ${p.likes?.length || 0}</span>
                <span>üí¨ ${p.comments?.length || 0}</span>
                <span>üìÖ ${new Date(p.createdAt).toLocaleDateString()}</span>
              </div>
            </div>
          </div>`
            )
            .join('')
        : `<p>${isOwner ? 'No has publicado' : 'No ha publicado'} nada a√∫n</p>`;
    document.getElementById('postsModal')?.classList.remove('hidden');
  } catch (err) {
    console.error('‚ùå Error cargando posts:', err);
    showNotification('Error al cargar publicaciones', 'error');
  }
});

// ============================================================
// üë• Ver seguidores
// ============================================================
document.getElementById('followers-stat')?.addEventListener('click', async () => {
  if (!viewedUser) return;
  try {
    await refreshProfileStats();
    
    const res = await fetch(`http://localhost:3000/api/users/${viewedUser._id}/followers`, {
      credentials: 'include',
    });
    
    if (!res.ok) throw new Error('Error al obtener seguidores');
    
    const followers = await res.json();
    const followersList = document.getElementById('followersList');
    followersList.innerHTML =
      followers.length > 0
        ? followers
            .map(
              f => `
          <div class="follower-item" onclick="window.location.href='/Profile?user=${f._id}'">
            <img src="${f.profilePic || `https://ui-avatars.com/api/?name=${encodeURIComponent(f.username)}`}" alt="${f.username}" />
            <span>${f.username}</span>
          </div>`
            )
            .join('')
        : `<p>${isOwner ? 'No tienes' : 'No tiene'} seguidores a√∫n</p>`;
    document.getElementById('followersModal')?.classList.remove('hidden');
  } catch (err) {
    console.error('‚ùå Error cargando seguidores:', err);
    showNotification('Error al cargar seguidores', 'error');
  }
});

// ============================================================
// ‚ù§Ô∏è Ver publicaciones con like
// ============================================================
document.getElementById('likes-stat')?.addEventListener('click', async () => {
  if (!viewedUser) return;
  try {
    await refreshProfileStats();
    
    const res = await fetch(`http://localhost:3000/api/users/${viewedUser._id}/liked-posts`, {
      credentials: 'include',
    });
    
    if (!res.ok) throw new Error('Error al obtener likes');
    
    const liked = await res.json();
    const likesList = document.getElementById('likesList');
    likesList.innerHTML =
      liked.length > 0
        ? liked
            .map(
              p => `
          <div class="like-item" onclick="window.location.href='/Social?post=${p._id}'">
            ${p.images?.[0] ? `<img src="${p.images[0]}" alt="Post" />` : '<div class="no-image">üìù</div>'}
            <div>
              <p>${p.caption || 'Sin descripci√≥n'}</p>
              <span>${p.likes?.length || 0} likes ‚Ä¢ ${p.comments?.length || 0} comentarios</span>
              <small>Por ${p.author?.username || 'Usuario'}</small>
            </div>
          </div>`
            )
            .join('')
        : `<p>${isOwner ? 'No has dado' : 'No ha dado'} likes a√∫n</p>`;
    document.getElementById('likesModal')?.classList.remove('hidden');
  } catch (err) {
    console.error('‚ùå Error cargando likes:', err);
    showNotification('Error al cargar publicaciones con like', 'error');
  }
});

// ============================================================
// üë• Unirse al grupo Food Emotions Team
// ============================================================
document.getElementById('join-team-button')?.addEventListener('click', async () => {
  try {
    const btn = document.getElementById('join-team-button');
    const currentState = btn.dataset.joined === 'true';
    
    const res = await fetch('http://localhost:3000/api/groups/food-emotions-team/join', {
      method: 'POST',
      credentials: 'include',
      headers: { 'Content-Type': 'application/json' },
    });
    
    if (!res.ok) throw new Error('Error al unirse al grupo');
    
    const data = await res.json();
    
    btn.dataset.joined = data.joined;
    
    if (data.joined) {
      btn.textContent = '‚úì Miembro del grupo';
      btn.style.background = 'linear-gradient(90deg, #7b8e62, #a0b38b)';
      btn.style.color = 'white';
      showNotification('Te has unido al grupo exitosamente');
    } else {
      btn.textContent = 'üë• Unirse al grupo';
      btn.style.background = 'white';
      btn.style.color = 'var(--primary-dark)';
      showNotification('Has salido del grupo');
    }
    
    const membersCountEl = document.getElementById('team-members-count');
    if (membersCountEl && data.memberCount) {
      membersCountEl.textContent = data.memberCount.toLocaleString();
    }
  } catch (err) {
    console.error('‚ùå Error:', err);
    showNotification('Error al procesar solicitud', 'error');
  }
});

// ‚úÖ Cargar estado del grupo al iniciar
async function loadGroupStatus() {
  try {
    const res = await fetch('http://localhost:3000/api/groups/food-emotions-team', {
      credentials: 'include',
    });
    
    if (!res.ok) return;
    
    const data = await res.json();
    const btn = document.getElementById('join-team-button');
    const membersCountEl = document.getElementById('team-members-count');
    
    if (btn) {
      btn.dataset.joined = data.isMember;
      
      if (data.isMember) {
        btn.textContent = '‚úì Miembro del grupo';
        btn.style.background = 'linear-gradient(90deg, #7b8e62, #a0b38b)';
        btn.style.color = 'white';
      } else {
        btn.textContent = 'üë• Unirse al grupo';
        btn.style.background = 'white';
        btn.style.color = 'var(--primary-dark)';
      }
    }
    
    if (membersCountEl && data.memberCount) {
      membersCountEl.textContent = data.memberCount.toLocaleString();
    }
  } catch (err) {
    console.error('‚ùå Error cargando estado del grupo:', err);
  }
}

// ============================================================
// üë• SISTEMA COMPLETO DE GRUPOS
// ============================================================

// üîπ Abrir modal de crear grupo
document.getElementById('create-group-btn')?.addEventListener('click', () => {
  document.getElementById('createGroupModal')?.classList.remove('hidden');
  
  // Limpiar formulario y preview
  document.getElementById('create-group-form')?.reset();
  const preview = document.getElementById('group-image-preview');
  const text = document.getElementById('image-preview-text');
  if (preview) preview.classList.add('hidden');
  if (text) text.textContent = 'üì∑ Seleccionar imagen';
});

// üîπ Preview de imagen al crear grupo
document.getElementById('select-group-image')?.addEventListener('click', () => {
  document.getElementById('group-image-file')?.click();
});

document.getElementById('group-image-file')?.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;
  
  const allowedTypes = ['image/jpeg', 'image/png', 'image/jpg', 'image/webp'];
  if (!allowedTypes.includes(file.type)) {
    showNotification('Solo se permiten im√°genes (JPG, PNG, WEBP)', 'error');
    e.target.value = '';
    return;
  }
  
  if (file.size > 5 * 1024 * 1024) {
    showNotification('La imagen no debe superar 5MB', 'error');
    e.target.value = '';
    return;
  }
  
  // Mostrar preview
  const reader = new FileReader();
  reader.onload = (event) => {
    const preview = document.getElementById('group-image-preview');
    const text = document.getElementById('image-preview-text');
    
    if (preview && text) {
      preview.src = event.target.result;
      preview.classList.remove('hidden');
      text.textContent = '‚úì Imagen seleccionada';
    }
  };
  reader.readAsDataURL(file);
});

// ============================================================
// ‚úÖ CREAR GRUPO - VERSI√ìN CORREGIDA
// ============================================================
document.getElementById('create-group-form')?.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  try {
    const name = document.getElementById('group-name').value.trim();
    const description = document.getElementById('group-description').value.trim();
    const imageFile = document.getElementById('group-image-file').files[0];
    
    if (!name) {
      showNotification('El nombre del grupo es requerido', 'error');
      return;
    }
    
    console.log('üîÑ Creando grupo:', { name, description, hasImage: !!imageFile });
    showNotification('Creando grupo...', 'success');
    
    let imageUrl = '';
    
    // ‚ö° NUEVA L√ìGICA: Primero subir imagen si existe
    if (imageFile) {
      try {
        console.log('üì§ Subiendo imagen del grupo a Cloudinary...');
        
        const imageFormData = new FormData();
        imageFormData.append('bannerImage', imageFile); // ‚ö†Ô∏è Debe ser 'bannerImage'
        
        const uploadRes = await fetch('http://localhost:3000/api/users/me/banner', {
          method: 'POST',
          credentials: 'include',
          body: imageFormData,
        });
        
        if (uploadRes.ok) {
          const uploadData = await uploadRes.json();
          imageUrl = uploadData.bannerImage;
          console.log('‚úÖ Imagen subida correctamente:', imageUrl);
        } else {
          const errorData = await uploadRes.json();
          console.warn('‚ö†Ô∏è Error subiendo imagen:', errorData);
          showNotification('Advertencia: No se pudo subir la imagen, continuando sin ella', 'error');
        }
      } catch (imgErr) {
        console.warn('‚ö†Ô∏è Error en subida de imagen:', imgErr);
        showNotification('Advertencia: Error al subir imagen', 'error');
      }
    }
    
    // üìù Ahora crear el grupo con la URL de Cloudinary
    const groupData = {
      name: name,
      description: description || '',
      image: imageUrl || '' // ‚ö° URL de Cloudinary o vac√≠o
    };
    
    console.log('üì§ Creando grupo con datos:', groupData);
    
    const res = await fetch('http://localhost:3000/api/groups', {
      method: 'POST',
      credentials: 'include',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(groupData),
    });
    
    console.log('üì° Respuesta del servidor:', res.status);
    
    if (!res.ok) {
      const error = await res.json();
      console.error('‚ùå Error del servidor:', error);
      throw new Error(error.message || 'Error al crear grupo');
    }
    
    const data = await res.json();
    console.log('‚úÖ Grupo creado exitosamente:', data);
    
    showNotification(`Grupo "${data.group.name}" creado exitosamente`);
    
    // Cerrar modal y limpiar
    document.getElementById('createGroupModal')?.classList.add('hidden');
    document.getElementById('create-group-form').reset();
    
    // Limpiar preview
    const preview = document.getElementById('group-image-preview');
    const text = document.getElementById('image-preview-text');
    if (preview) preview.classList.add('hidden');
    if (text) text.textContent = 'üì∑ Seleccionar imagen';
    
    // Recargar lista de grupos
    await loadAllGroups();
    
    // Abrir detalles del grupo reci√©n creado
    setTimeout(() => {
      if (data.group.slug) {
        viewGroupDetails(data.group.slug);
      }
    }, 500);
    
  } catch (err) {
    console.error('‚ùå Error completo:', err);
    showNotification(err.message || 'Error al crear grupo', 'error');
  }
});

// ============================================================
// üîß CARGAR GRUPOS 
// ============================================================
async function loadAllGroups() {
  try {
    console.log('üîÑ Cargando grupos...');
    
    const res = await fetch('http://localhost:3000/api/groups', {
      credentials: 'include',
      headers: {
        'Accept': 'application/json'
      }
    });
    
    if (!res.ok) {
      console.error('‚ùå Error cargando grupos:', res.status);
      return;
    }
    
    const data = await res.json();
    
    const groups = data.groups || data;
    
    console.log('‚úÖ Grupos cargados:', groups.length);
    
    const groupsList = document.getElementById('groups-list');
    if (!groupsList) return;
    
    // Filtrar el grupo Food Emotions Team
    const otherGroups = groups.filter(g => g.slug !== 'food-emotions-team');
    
    if (otherGroups.length === 0) {
      groupsList.innerHTML = '<p class="no-groups">No hay otros grupos disponibles. ¬°Crea el primero!</p>';
      return;
    }
    
    groupsList.innerHTML = otherGroups.map(group => `
      <div class="group-card-small" data-slug="${group.slug}">
        ${group.image ? 
          `<img src="${group.image}" alt="${group.name}" class="group-small-image" />` : 
          `<div class="group-icon">üë•</div>`
        }
        <div class="group-info">
          <h5>${group.name}</h5>
          <p>${group.memberCount || 0} miembros</p>
          ${group.isMember ? '<span class="member-badge">‚úì Miembro</span>' : ''}
        </div>
        <button class="view-group-btn" data-slug="${group.slug}">Ver</button>
      </div>
    `).join('');
    
    // Event listeners para ver detalles
    document.querySelectorAll('.view-group-btn').forEach(btn => {
      btn.addEventListener('click', () => viewGroupDetails(btn.dataset.slug));
    });
    
  } catch (err) {
    console.error('‚ùå Error cargando grupos:', err);
    showNotification('Error al cargar grupos', 'error');
  }
}

// ============================================================
// üîç VER DETALLES DE GRUPO - CON BOT√ìN DE IR A P√ÅGINA
// ============================================================
async function viewGroupDetails(slug) {
  try {
    console.log('üîç Cargando detalles del grupo:', slug);
    
    const res = await fetch(`http://localhost:3000/api/groups/${slug}`, {
      credentials: 'include',
      headers: {
        'Accept': 'application/json'
      }
    });
    
    if (!res.ok) {
      throw new Error('Grupo no encontrado');
    }
    
    const group = await res.json();
    console.log('‚úÖ Grupo cargado:', group);
    
    const modal = document.getElementById('groupDetailsModal');
    const content = document.getElementById('group-details-content');
    
    if (!modal || !content) return;
    
    // ‚úÖ Verificar si el usuario es el creador
    const isCreator = currentUser && group.createdBy && 
      (currentUser._id === group.createdBy._id || currentUser._id === group.createdBy);
    
    content.innerHTML = `
      <div class="group-details">
        ${group.image ? 
          `<img src="${group.image}" alt="${group.name}" class="group-detail-image" />` : 
          '<div class="group-detail-placeholder">üë•</div>'
        }
        <h2>${group.name}</h2>
        <p class="group-description">${group.description || 'Sin descripci√≥n'}</p>
        
        <div class="group-stats">
          <div class="stat">
            <span class="stat-number">${group.memberCount || 0}</span>
            <span class="stat-label">Miembros</span>
          </div>
          <div class="stat">
            <span class="stat-number">${group.postCount || 0}</span>
            <span class="stat-label">Publicaciones</span>
          </div>
          <div class="stat">
            <span class="stat-number">${new Date(group.createdAt).toLocaleDateString()}</span>
            <span class="stat-label">Creado</span>
          </div>
        </div>
        
        <div class="group-actions">
          <!-- ‚ö° BOT√ìN PRINCIPAL PARA IR A LA P√ÅGINA DEL GRUPO -->
          <button id="go-to-group-page" class="modal-btn primary-btn" data-slug="${slug}">
            üöÄ Ver p√°gina completa del grupo
          </button>
          
          <button id="toggle-group-membership" class="modal-btn confirm" data-slug="${slug}" data-member="${group.isMember}">
            ${group.isMember ? '‚úì Miembro del Grupo' : 'üë• Unirse al Grupo'}
          </button>
          
          ${isCreator ? `
            <button id="edit-group-btn" class="modal-btn" data-slug="${slug}">
              ‚úèÔ∏è Editar Grupo
            </button>
            <button id="delete-group-btn" class="modal-btn delete-btn" data-slug="${slug}">
              üóëÔ∏è Eliminar Grupo
            </button>
          ` : ''}
        </div>
        
        ${group.members && group.members.length > 0 ? `
          <div class="group-members">
            <h3>Miembros (${group.members.length})</h3>
            <div class="members-grid">
              ${group.members.slice(0, 12).map(member => `
                <div class="member-item" onclick="window.location.href='/Profile?user=${member._id}'">
                  <img src="${member.profilePic || `https://ui-avatars.com/api/?name=${encodeURIComponent(member.username)}`}" alt="${member.username}" />
                  <span>${member.username}</span>
                  ${member.status ? `<span class="status-indicator status-${member.status.toLowerCase()}">${member.status}</span>` : ''}
                </div>
              `).join('')}
            </div>
            ${group.members.length > 12 ? `<p class="more-members">+${group.members.length - 12} miembros m√°s</p>` : ''}
          </div>
        ` : '<p class="no-members">No hay miembros a√∫n. ¬°S√© el primero en unirte!</p>'}
      </div>
    `;
    
    modal.classList.remove('hidden');
    
    // ‚ö° Event listener para ir a la p√°gina del grupo
    document.getElementById('go-to-group-page')?.addEventListener('click', (e) => {
      const groupSlug = e.target.dataset.slug;
      window.location.href = `/Group?slug=${groupSlug}`;
    });
    
    // ‚ö° Event listener para unirse/salir
    document.getElementById('toggle-group-membership')?.addEventListener('click', async (e) => {
      const btn = e.target;
      const groupSlug = btn.dataset.slug;
      
      try {
        const res = await fetch(`http://localhost:3000/api/groups/${groupSlug}/join`, {
          method: 'POST',
          credentials: 'include',
          headers: { 'Content-Type': 'application/json' },
        });
        
        if (!res.ok) throw new Error('Error al procesar solicitud');
        
        const data = await res.json();
        console.log('‚úÖ Estado actualizado:', data);
        
        btn.textContent = data.joined ? '‚úì Miembro del Grupo' : 'üë• Unirse al Grupo';
        btn.dataset.member = data.joined;
        
        showNotification(data.message);
        
        // Recargar detalles despu√©s de 500ms
        setTimeout(() => viewGroupDetails(groupSlug), 500);
        
        // Recargar lista de grupos en el background
        loadAllGroups();
      } catch (err) {
        console.error('‚ùå Error:', err);
        showNotification('Error al procesar solicitud', 'error');
      }
    });
    
    // ‚ö° Event listener para eliminar grupo
    document.getElementById('delete-group-btn')?.addEventListener('click', async (e) => {
      const groupSlug = e.target.dataset.slug;
      
      if (!confirm(`¬øEst√°s seguro de que quieres eliminar el grupo "${group.name}"? Esta acci√≥n no se puede deshacer.`)) {
        return;
      }
      
      try {
        const res = await fetch(`http://localhost:3000/api/groups/${groupSlug}`, {
          method: 'DELETE',
          credentials: 'include',
        });
        
        if (!res.ok) {
          const error = await res.json();
          throw new Error(error.message || 'Error al eliminar grupo');
        }
        
        showNotification('Grupo eliminado exitosamente');
        modal.classList.add('hidden');
        
        // Recargar lista de grupos
        await loadAllGroups();
      } catch (err) {
        console.error('‚ùå Error eliminando grupo:', err);
        showNotification(err.message || 'Error al eliminar grupo', 'error');
      }
    });
    
  } catch (err) {
    console.error('‚ùå Error cargando detalles del grupo:', err);
    showNotification('Error al cargar detalles del grupo', 'error');
  }
}

// ============================================================
// ‚úèÔ∏è EDITAR GRUPO (agregar despu√©s de la funci√≥n viewGroupDetails)
// ============================================================
document.addEventListener('click', async (e) => {
  // Detectar clic en el bot√≥n de editar
  if (e.target.id === 'edit-group-btn' || e.target.closest('#edit-group-btn')) {
    const btn = e.target.id === 'edit-group-btn' ? e.target : e.target.closest('#edit-group-btn');
    const slug = btn.dataset.slug;
    
    try {
      console.log('‚úèÔ∏è Abriendo editor para grupo:', slug);
      
      // Obtener datos actuales del grupo
      const res = await fetch(`http://localhost:3000/api/groups/${slug}`, {
        credentials: 'include',
        headers: { 'Accept': 'application/json' }
      });
      
      if (!res.ok) throw new Error('Error cargando grupo');
      
      const group = await res.json();
      
      // Crear modal de edici√≥n
      const editModal = createEditGroupModal(group, slug);
      document.body.appendChild(editModal);
      
    } catch (err) {
      console.error('‚ùå Error:', err);
      showNotification('Error al cargar datos del grupo', 'error');
    }
  }
});

// ============================================================
// üé® CREAR MODAL DE EDICI√ìN DE GRUPO - CON SUBIDA DE ARCHIVOS
// ============================================================
function createEditGroupModal(group, slug) {
  const modal = document.createElement('div');
  modal.className = 'modal';
  modal.id = 'edit-group-modal-instance';
  
  modal.innerHTML = `
    <div class="modal-content">
      <button class="close-modal" id="close-edit-modal">√ó</button>
      <h2>‚úèÔ∏è Editar Grupo</h2>
      
      <form id="edit-group-form">
        <div class="form-group">
          <label for="edit-group-name">Nombre del grupo *</label>
          <input 
            type="text" 
            id="edit-group-name" 
            value="${group.name || ''}" 
            required 
            placeholder="Nombre del grupo"
          />
        </div>
        
        <div class="form-group">
          <label for="edit-group-description">Descripci√≥n</label>
          <textarea 
            id="edit-group-description" 
            rows="4" 
            placeholder="Describe tu grupo..."
          >${group.description || ''}</textarea>
        </div>
        
        <div class="form-group">
          <label>Imagen del grupo</label>
          <div style="display: flex; gap: 10px; margin-bottom: 10px;">
            <button type="button" id="edit-upload-file-btn" class="modal-btn" style="flex: 1;">
              üìÅ Subir imagen
            </button>
            <button type="button" id="edit-use-url-btn" class="modal-btn" style="flex: 1;">
              üåê Usar URL
            </button>
          </div>
          <input type="file" id="edit-group-image-file" accept="image/*" hidden />
          <input 
            type="url" 
            id="edit-group-image-url" 
            value="${group.image || ''}" 
            placeholder="https://ejemplo.com/imagen.jpg"
            style="display: none; width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; margin-top: 10px;"
          />
        </div>
        
        ${group.image ? `
          <div class="form-group">
            <label>Vista previa</label>
            <img 
              id="edit-image-preview" 
              src="${group.image}" 
              alt="Preview"
              style="width: 100%; max-height: 200px; object-fit: cover; border-radius: 12px; border: 2px solid var(--border-color);"
            />
          </div>
        ` : `
          <div class="form-group" id="preview-container" style="display: none;">
            <label>Vista previa</label>
            <img 
              id="edit-image-preview" 
              src="" 
              alt="Preview"
              style="width: 100%; max-height: 200px; object-fit: cover; border-radius: 12px; border: 2px solid var(--border-color);"
            />
          </div>
        `}
        
        <div style="display: flex; gap: 12px; margin-top: 20px;">
          <button type="submit" class="modal-btn confirm" style="flex: 1;">
            üíæ Guardar Cambios
          </button>
          <button type="button" id="cancel-edit-btn" class="modal-btn" style="flex: 1;">
            Cancelar
          </button>
        </div>
      </form>
      
      <div id="edit-loading" style="display: none; text-align: center; margin-top: 20px;">
        <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite;"></div>
        <p style="margin-top: 10px; color: #666;">Guardando cambios...</p>
      </div>
    </div>
    
    <style>
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  `;
  
  // Event listeners del modal
  const form = modal.querySelector('#edit-group-form');
  const closeBtn = modal.querySelector('#close-edit-modal');
  const cancelBtn = modal.querySelector('#cancel-edit-btn');
  const uploadFileBtn = modal.querySelector('#edit-upload-file-btn');
  const useUrlBtn = modal.querySelector('#edit-use-url-btn');
  const imageFileInput = modal.querySelector('#edit-group-image-file');
  const imageUrlInput = modal.querySelector('#edit-group-image-url');
  const imagePreview = modal.querySelector('#edit-image-preview');
  const previewContainer = modal.querySelector('#preview-container');
  const loadingDiv = modal.querySelector('#edit-loading');
  
  let uploadedImageUrl = group.image || ''; // Guardar la URL subida
  
  // Cerrar modal
  const closeModal = () => {
    modal.remove();
  };
  
  closeBtn.addEventListener('click', closeModal);
  cancelBtn.addEventListener('click', closeModal);
  
  modal.addEventListener('click', (e) => {
    if (e.target === modal) closeModal();
  });
  
  // Bot√≥n: Subir archivo
  uploadFileBtn.addEventListener('click', () => {
    imageFileInput.click();
  });
  
  // Bot√≥n: Usar URL
  useUrlBtn.addEventListener('click', () => {
    const isVisible = imageUrlInput.style.display === 'block';
    imageUrlInput.style.display = isVisible ? 'none' : 'block';
    if (!isVisible) imageUrlInput.focus();
  });
  
  // Subir archivo y mostrar preview
  imageFileInput.addEventListener('change', async (e) => {
    const file = e.target.files[0];
    if (!file) return;
    
    const allowedTypes = ['image/jpeg', 'image/png', 'image/jpg', 'image/webp'];
    if (!allowedTypes.includes(file.type)) {
      showNotification('Solo se permiten im√°genes (JPG, PNG, WEBP)', 'error');
      e.target.value = '';
      return;
    }
    
    if (file.size > 5 * 1024 * 1024) {
      showNotification('La imagen no debe superar 5MB', 'error');
      e.target.value = '';
      return;
    }
    
    // Mostrar preview local primero
    const reader = new FileReader();
    reader.onload = (event) => {
      if (imagePreview && previewContainer) {
        imagePreview.src = event.target.result;
        previewContainer.style.display = 'block';
      }
    };
    reader.readAsDataURL(file);
    
    // Subir a Cloudinary
    try {
      showNotification('Subiendo imagen...', 'success');
      
      const formData = new FormData();
      formData.append('bannerImage', file);
      
      const uploadRes = await fetch('http://localhost:3000/api/users/me/banner', {
        method: 'POST',
        credentials: 'include',
        body: formData,
      });
      
      if (uploadRes.ok) {
        const uploadData = await uploadRes.json();
        uploadedImageUrl = uploadData.bannerImage;
        
        if (imagePreview) {
          imagePreview.src = uploadedImageUrl;
        }
        
        showNotification('Imagen subida correctamente', 'success');
        console.log('‚úÖ Nueva imagen subida:', uploadedImageUrl);
      } else {
        throw new Error('Error al subir imagen');
      }
    } catch (err) {
      console.error('‚ùå Error subiendo imagen:', err);
      showNotification('Error al subir imagen', 'error');
    }
  });
  
  // Preview de URL en tiempo real
  imageUrlInput.addEventListener('input', (e) => {
    const url = e.target.value.trim();
    if (url && imagePreview && previewContainer) {
      uploadedImageUrl = url;
      imagePreview.src = url;
      previewContainer.style.display = 'block';
    }
  });
  
  // Submit del formulario
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const name = document.getElementById('edit-group-name').value.trim();
    const description = document.getElementById('edit-group-description').value.trim();
    
    if (!name) {
      showNotification('El nombre del grupo es requerido', 'error');
      return;
    }
    
    try {
      form.style.display = 'none';
      loadingDiv.style.display = 'block';
      
      console.log('üì§ Actualizando grupo:', { name, description, image: uploadedImageUrl });
      
      const res = await fetch(`http://localhost:3000/api/groups/${slug}`, {
        method: 'PUT',
        credentials: 'include',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          name,
          description,
          image: uploadedImageUrl // ‚ö° Usar la URL guardada
        })
      });
      
      if (!res.ok) {
        const error = await res.json();
        throw new Error(error.message || 'Error al actualizar grupo');
      }
      
      const data = await res.json();
      console.log('‚úÖ Grupo actualizado:', data);
      
      showNotification('Grupo actualizado exitosamente');
      closeModal();
      
      const detailsModal = document.getElementById('groupDetailsModal');
      if (detailsModal) {
        detailsModal.classList.add('hidden');
      }
      
      await loadAllGroups();
      
      setTimeout(() => {
        if (data.group && data.group.slug) {
          viewGroupDetails(data.group.slug);
        } else {
          viewGroupDetails(slug);
        }
      }, 500);
      
    } catch (err) {
      console.error('‚ùå Error actualizando grupo:', err);
      showNotification(err.message || 'Error al actualizar grupo', 'error');
      
      form.style.display = 'block';
      loadingDiv.style.display = 'none';
    }
  });
  
  return modal;
}

// ============================================================
// üö™ Ir al feed / cerrar sesi√≥n
// ============================================================
document.getElementById('go-to-feed')?.addEventListener('click', () => {
  window.location.href = '/Social';
});

document.getElementById('logout-button')?.addEventListener('click', async () => {
  if (!confirm('¬øCerrar sesi√≥n?')) return;
  await fetch('http://localhost:3000/logout', { method: 'POST', credentials: 'include' });
  window.location.href = '/login';
});

// ============================================================
// ü™ü Cerrar modales al hacer clic fuera
// ============================================================
document.addEventListener('click', e => {
  if (e.target.classList.contains('modal')) {
    e.target.classList.add('hidden');
  }
  
  if (!e.target.closest('#profile-search') && 
      !e.target.closest('#profile-search-results')) {
    profileSearchResults?.classList.add('hidden');
  }
});

// ============================================================
// üöÄ Inicializar
// ============================================================
async function initialize() {
  await loadProfileData();
  await loadGroupStatus();
  await loadAllGroups();
}

if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initialize);
} else {
  initialize();
}
</script>

<style>
:root {
  --primary: #687450;
  --primary-dark: #425638;
  --accent: #7b8e62;
  --secondary: #a0b38b;
  --bg-light: #f4f7f3;
  --bg-dark: #2d332b;
  --card-bg: #ffffff;
  --text-dark: #222;
  --text-light: #e6e9e3;
  --border-color: #c7d0c1;
  --radius: 14px;
  --shadow-sm: 0 2px 6px rgba(0, 0, 0, 0.08);
  --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.12);
  --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.2);
  font-family: "Poppins", sans-serif;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  background: var(--bg-light);
  color: var(--text-dark);
  min-height: 100vh;
}

/* === ANIMACIONES === */
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

@keyframes slideIn {
  from {
    transform: translateX(300px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes modalSlideIn {
  from {
    transform: translateY(-50px) scale(0.95);
    opacity: 0;
  }
  to {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* === CONTENEDOR PRINCIPAL === */
.profile-container {
  display: grid;
  grid-template-columns: 1.1fr 2fr 1fr;
  gap: 24px;
  padding: 30px;
  max-width: 1400px;
  margin: 80px auto 30px;
}

/* === COLUMNA IZQUIERDA === */
.left-section {
  background: linear-gradient(180deg, var(--primary-dark), var(--primary));
  color: var(--text-light);
  padding: 26px;
  border-radius: var(--radius);
  box-shadow: var(--shadow-md);
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  height: fit-content;
  position: sticky;
  top: 100px;
}

.profile-pic-container {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.profile-image {
  width: 150px;
  height: 150px;
  border-radius: 50%;
  border: 4px solid var(--secondary);
  object-fit: cover;
  margin-bottom: 16px;
  box-shadow: 0 0 20px rgba(104, 116, 80, 0.5);
  transition: all 0.3s ease;
}

.profile-image:hover {
  transform: scale(1.08);
  box-shadow: 0 0 30px rgba(104, 116, 80, 0.7);
}

.upload-section {
  width: 100%;
}

.upload-button,
:global(.feed-btn),
.logout-button {
  border: none;
  padding: 11px 16px;
  border-radius: 8px;
  color: white;
  font-weight: 600;
  margin-top: 10px;
  width: 100%;
  transition: all 0.3s ease;
  cursor: pointer;
  font-size: 0.95rem;
  letter-spacing: 0.3px;
}

.upload-button,
:global(.feed-btn) {
  background: linear-gradient(90deg, var(--primary), var(--accent));
  box-shadow: 0 3px 8px rgba(104, 116, 80, 0.3);
}

.upload-button:hover,
:global(.feed-btn:hover) {
  transform: translateY(-3px);
  filter: brightness(1.15);
  box-shadow: 0 5px 15px rgba(104, 116, 80, 0.4);
}

.logout-button {
  background: linear-gradient(90deg, #b83c3c, #933232);
  box-shadow: 0 3px 8px rgba(184, 60, 60, 0.3);
}

.logout-button:hover {
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(184, 60, 60, 0.4);
}

.user-info {
  width: 100%;
}

.user-info h2 {
  font-size: 1.4rem;
  font-weight: 700;
  margin-top: 12px;
  margin-bottom: 8px;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.status-label {
  font-size: 0.9rem;
  font-weight: 500;
  display: block;
  margin-top: 8px;
  margin-bottom: 4px;
  opacity: 0.9;
}

#status-select {
  background: #374030;
  color: var(--text-light);
  border: 1px solid #4e5748;
  border-radius: 6px;
  padding: 8px 12px;
  margin-top: 6px;
  font-size: 0.9rem;
  width: 100%;
  cursor: pointer;
  transition: all 0.3s ease;
}

#status-select:hover {
  background: #424b36;
  border-color: var(--secondary);
}

#status-select:focus {
  outline: none;
  border-color: var(--secondary);
  box-shadow: 0 0 0 3px rgba(160, 179, 139, 0.2);
}

/* === ESTAD√çSTICAS MEJORADAS === */
.user-stats {
  margin-top: 20px;
  width: 100%;
  background: rgba(255, 255, 255, 0.08);
  padding: 16px;
  border-radius: var(--radius);
  display: flex;
  flex-direction: column;
  gap: 8px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.user-stats span {
  color: #cce5b5;
  font-weight: 700;
  font-size: 1.1rem;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.user-stats p {
  margin: 0;
  font-weight: 600;
  font-size: 0.95rem;
  color: #f0f2f0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 12px;
  border-radius: 8px;
  transition: all 0.3s ease;
  cursor: pointer;
}

.user-stats p:hover {
  background: rgba(255, 255, 255, 0.15);
  transform: translateX(5px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.user-stats p:hover span {
  filter: brightness(1.3);
  transform: scale(1.08);
}

.user-stats p:active {
  transform: translateX(3px) scale(0.98);
}

.user-links {
  margin-top: 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  width: 100%;
}

.user-links a {
  display: block;
  color: #d4e2c2;
  font-weight: 500;
  text-decoration: none;
  transition: all 0.3s ease;
  padding: 10px 12px;
  border-radius: 8px;
  font-size: 0.95rem;
}

.user-links a:hover {
  color: white;
  background: rgba(255, 255, 255, 0.1);
  transform: translateX(5px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

/* === COLUMNA CENTRAL === */
.main-section {
  background: var(--card-bg);
  border-radius: var(--radius);
  box-shadow: var(--shadow-md);
  padding: 26px;
  animation: fadeIn 0.5s ease;
}

/* === B√öSQUEDA MEJORADA === */
:global(.search-input) {
  width: 100%;
  padding: 14px 18px;
  border-radius: var(--radius);
  border: 2px solid var(--border-color);
  margin-bottom: 20px;
  font-size: 1rem;
  outline: none;
  transition: all 0.3s ease;
  font-family: inherit;
}

:global(.search-input:focus) {
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(104, 116, 80, 0.15);
  transform: translateY(-2px);
}

:global(.search-input::placeholder) {
  color: #999;
}

/* === RESULTADOS DE B√öSQUEDA MEJORADOS === */
:global(.search-results) {
  position: absolute;
  background: white;
  border: 2px solid var(--primary);
  border-radius: var(--radius);
  box-shadow: var(--shadow-lg);
  max-height: 450px;
  overflow-y: auto;
  width: calc(100% - 52px);
  z-index: 100;
  margin-top: -10px;
  animation: modalSlideIn 0.3s ease;
}

:global(.search-result-item) {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
  border-bottom: 1px solid var(--bg-light);
}

:global(.search-result-item:last-child) {
  border-bottom: none;
}

:global(.search-result-item:hover) {
  background: var(--bg-light);
  padding-left: 18px;
}

:global(.search-result-item img) {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid var(--primary);
  flex-shrink: 0;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
}

:global(.search-result-item div) {
  flex: 1;
  min-width: 0;
}

:global(.search-result-item strong) {
  color: var(--text-dark);
  font-weight: 600;
  font-size: 1rem;
  display: block;
  margin-bottom: 2px;
}

:global(.search-result-item p) {
  margin: 0;
  color: #666;
  font-size: 0.85rem;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.no-results {
  padding: 30px 20px;
  text-align: center;
  color: #999;
  font-style: italic;
}

/* === BANNER MEJORADO === */
:global(.banner) {
  border-radius: var(--radius);
  overflow: hidden;
  margin-bottom: 24px;
  box-shadow: var(--shadow-md);
  position: relative;
  height: 280px;
  border: 3px solid var(--border-color);
}

:global(.banner-image) {
  width: 100%;
  height: 100%;
  object-fit: cover;
  filter: brightness(0.96);
  transition: all 0.4s ease;
}

:global(.banner:hover .banner-image) {
  filter: brightness(1.05);
  transform: scale(1.02);
}

.change-banner-btn {
  position: absolute;
  bottom: 18px;
  right: 18px;
  background: rgba(104, 116, 80, 0.95);
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 10px;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(8px);
  font-size: 0.95rem;
}

.change-banner-btn:hover {
  background: var(--primary-dark);
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
}

/* === SECCI√ìN DE GRUPOS MEJORADA === */
:global(.team-info) {
  margin-top: 20px;
}

:global(.team-info h3) {
  color: var(--primary-dark);
  font-size: 1.3rem;
  margin-bottom: 16px;
  font-weight: 600;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

:global(.create-group-btn) {
  background: var(--primary);
  color: white;
  border: none;
  padding: 9px 18px;
  border-radius: 8px;
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 2px 6px rgba(104, 116, 80, 0.3);
}

:global(.create-group-btn:hover) {
  background: var(--primary-dark);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(104, 116, 80, 0.4);
}

/* Bot√≥n principal destacado */
:global(.primary-btn) {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
  color: white !important;
  font-weight: 700 !important;
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4) !important;
  border: none !important;
  width: 100%;
}

:global(.primary-btn:hover) {
  transform: translateY(-3px) !important;
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6) !important;
  background: linear-gradient(135deg, #764ba2 0%, #667eea 100%) !important;
}

/* === LISTA DE GRUPOS MEJORADA === */
:global(.groups-list) {
  margin-bottom: 20px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

:global(.group-card-small) {
  background: white;
  border: 2px solid var(--border-color);
  border-radius: var(--radius);
  padding: 14px;
  display: flex;
  align-items: center;
  gap: 14px;
  transition: all 0.3s ease;
  cursor: pointer;
}

:global(.group-card-small:hover) {
  border-color: var(--primary);
  box-shadow: var(--shadow-md);
  transform: translateY(-3px);
}

:global(.group-small-image) {
  width: 55px;
  height: 55px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid var(--primary);
  flex-shrink: 0;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

:global(.group-icon) {
  width: 55px;
  height: 55px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.6rem;
  flex-shrink: 0;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

:global(.group-info) {
  flex: 1;
  min-width: 0;
}

:global(.group-info h5) {
  margin: 0 0 5px 0;
  color: var(--text-dark);
  font-size: 1rem;
  font-weight: 600;
}

:global(.group-info p) {
  margin: 0;
  color: #777;
  font-size: 0.85rem;
}

.view-group-btn {
  background: var(--primary);
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  flex-shrink: 0;
}

.view-group-btn:hover {
  background: var(--primary-dark);
  transform: translateX(-3px);
}

.no-groups {
  text-align: center;
  color: #999;
  padding: 25px;
  font-style: italic;
  background: var(--bg-light);
  border-radius: var(--radius);
}

/* === TARJETA FOOD EMOTIONS TEAM === */
.team-card {
  background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
  color: white;
  padding: 24px;
  border-radius: var(--radius);
  box-shadow: var(--shadow-md);
  text-align: center;
  margin-top: 12px;
  transition: all 0.3s ease;
  border: 2px solid rgba(255, 255, 255, 0.2);
}

.team-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-lg);
}

.team-card h4 {
  font-weight: 700;
  font-size: 1.3rem;
  margin-bottom: 10px;
  letter-spacing: 1.5px;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.team-card p {
  margin: 8px 0;
  opacity: 0.95;
  font-size: 0.95rem;
}

.team-action-btn {
  margin-top: 16px;
  background: white;
  color: var(--primary-dark);
  border: none;
  border-radius: 10px;
  padding: 12px 24px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
  width: 100%;
  font-size: 1rem;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
}

.team-action-btn:hover {
  background: var(--secondary);
  color: white;
  transform: scale(1.05);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

/* === FORMULARIO DE CREAR GRUPO MEJORADO === */
:global(.form-group) {
  margin-bottom: 22px;
  text-align: left;
}

:global(.form-group label) {
  display: block;
  margin-bottom: 10px;
  color: var(--text-dark);
  font-weight: 600;
  font-size: 0.95rem;
}

:global(.form-group input),
:global(.form-group textarea) {
  width: 100%;
  padding: 12px 14px;
  border: 2px solid var(--border-color);
  border-radius: var(--radius);
  font-size: 1rem;
  font-family: inherit;
  transition: all 0.3s ease;
}

:global(.form-group input:focus),
:global(.form-group textarea:focus) {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(104, 116, 80, 0.15);
}

:global(.form-group textarea) {
  resize: vertical;
  min-height: 90px;
  line-height: 1.5;
}

/* === PREVIEW DE IMAGEN MEJORADO === */
:global(.image-upload-container) {
  width: 100%;
}

:global(.image-preview-btn) {
  width: 100%;
  min-height: 180px;
  border: 3px dashed var(--border-color);
  border-radius: var(--radius);
  background: var(--bg-light);
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 24px;
  position: relative;
  overflow: visible;
}

:global(.image-preview-btn:hover) {
  border-color: var(--primary);
  background: white;
  transform: translateY(-2px);
}

#image-preview-text {
  font-size: 1rem;
  color: #666;
  font-weight: 500;
  transition: all 0.3s ease;
}

:global(.image-preview-btn:hover #image-preview-text) {
  color: var(--primary);
}

/* === FIX: Imagen circular con tama√±o controlado === */
#group-image-preview {
  width: 130px;
  height: 130px;
  object-fit: cover;
  border-radius: 50%;
  border: 4px solid var(--primary);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  margin-top: 10px;
}

#group-image-preview.hidden {
  display: none;
}

.image-preview-btn:has(#group-image-preview:not(.hidden)) {
  min-height: auto;
  padding: 24px;
  border-style: solid;
  border-color: var(--primary);
  background: white;
}

/* === MODAL DE DETALLES DEL GRUPO === */
:global(.group-details-modal) {
  max-width: 850px;
}

:global(.group-details) {
  text-align: center;
}

:global(.group-detail-image) {
  width: 100%;
  max-height: 280px;
  object-fit: cover;
  border-radius: var(--radius);
  margin-bottom: 24px;
  box-shadow: var(--shadow-md);
  border: 3px solid var(--border-color);
}

:global(.group-detail-placeholder) {
  width: 100%;
  height: 220px;
  background: linear-gradient(135deg, var(--primary), var(--accent));
  border-radius: var(--radius);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 6rem;
  color: white;
  margin-bottom: 24px;
  box-shadow: var(--shadow-md);
}

:global(.group-description) {
  color: #555;
  margin: 20px 0;
  line-height: 1.7;
  font-size: 1.05rem;
}

:global(.group-stats) {
  display: flex;
  justify-content: center;
  gap: 50px;
  margin: 28px 0;
  padding: 24px;
  background: var(--bg-light);
  border-radius: var(--radius);
  border: 2px solid var(--border-color);
}

:global(.stat) {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 5px;
}

:global(.stat-number) {
  font-size: 1.8rem;
  font-weight: 700;
  color: var(--primary);
}

:global(.stat-label) {
  font-size: 0.9rem;
  color: #666;
  font-weight: 500;
  margin-top: 4px;
}

/* === ACCIONES DEL GRUPO === */
:global(.group-actions) {
  display: flex;
  gap: 14px;
  margin: 24px 0;
  flex-wrap: wrap;
}

:global(.group-actions .modal-btn) {
  flex: 1;
  min-width: 170px;
}

:global(.delete-btn) {
  background: #d32f2f !important;
  color: white !important;
  border: none !important;
  box-shadow: 0 3px 10px rgba(211, 47, 47, 0.3);
}

:global(.delete-btn:hover) {
  background: #b71c1c !important;
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(211, 47, 47, 0.4);
}

/* === MIEMBROS DEL GRUPO === */
:global(.group-members) {
  margin-top: 35px;
  text-align: left;
}

:global(.group-members h3) {
  color: var(--primary-dark);
  margin-bottom: 20px;
  font-size: 1.2rem;
  font-weight: 600;
}

:global(.members-grid) {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
  gap: 18px;
}

:global(.member-item) {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  cursor: pointer;
  padding: 12px;
  border-radius: var(--radius);
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

:global(.member-item:hover) {
  background: var(--bg-light);
  transform: translateY(-5px);
  border-color: var(--primary);
}

:global(.member-item img) {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid var(--primary);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  transition: all 0.3s ease;
}

:global(.member-item:hover img) {
  transform: scale(1.1);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
}

:global(.member-item span) {
  font-size: 0.85rem;
  color: var(--text-dark);
  font-weight: 500;
  text-align: center;
  max-width: 90px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* === COLUMNA DERECHA === */
:global(.right-section) {
  background: linear-gradient(180deg, var(--primary-dark), var(--primary));
  color: var(--text-light);
  border-radius: var(--radius);
  padding: 26px;
  box-shadow: var(--shadow-md);
  display: flex;
  flex-direction: column;
  height: fit-content;
  position: sticky;
  top: 100px;
}

/* === COMPONENTE BIBLIOGRAPHY MEJORADO === */
:global(.bibliography-card) {
  background: rgba(255, 255, 255, 0.1);
  border-radius: var(--radius);
  padding: 22px;
  margin-bottom: 22px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: all 0.3s ease;
}

:global(.bibliography-card:hover) {
  background: rgba(255, 255, 255, 0.15);
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
}

:global(.bio-header) {
  border-bottom: 2px solid var(--secondary);
  padding-bottom: 12px;
  margin-bottom: 18px;
}

:global(.bio-header h3) {
  margin: 0;
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--text-light);
  display: flex;
  align-items: center;
  gap: 10px;
}

:global(.bio-content) {
  margin-bottom: 18px;
  min-height: 70px;
}

#bio-text {
  margin: 0;
  line-height: 1.7;
  color: var(--text-light);
  font-size: 0.95rem;
}

:global(.bio-footer) {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

:global(.bio-meta) {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px;
  background: rgba(255, 255, 255, 0.08);
  border-radius: 10px;
  transition: all 0.3s ease;
}

:global(.bio-meta:hover) {
  background: rgba(255, 255, 255, 0.15);
  transform: translateX(3px);
}

:global(.bio-icon) {
  font-size: 1.3rem;
}

#bio-website {
  color: #cce5b5;
  text-decoration: none;
  font-weight: 500;
  font-size: 0.9rem;
  transition: all 0.3s ease;
}

#bio-website:hover {
  color: white;
  text-decoration: underline;
}

:global(.bio-skills) {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

:global(.bio-skill-tag) {
  background: var(--accent);
  color: white;
  padding: 7px 14px;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 500;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

/* === BIOGRAPHY EDITOR === */
:global(.bio-editor) {
  background: #374030;
  color: var(--text-light);
  width: 100%;
  border-radius: var(--radius);
  border: 1px solid #4e5748;
  margin-top: 18px;
  padding: 14px;
  font-size: 0.95rem;
  resize: vertical;
  min-height: 110px;
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
  font-family: inherit;
  line-height: 1.6;
  transition: all 0.3s ease;
}

:global(.bio-editor:focus) {
  outline: none;
  border-color: var(--secondary);
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3), 0 0 0 3px rgba(160, 179, 139, 0.2);
}

:global(.save-bio-btn) {
  margin-top: 16px;
  padding: 12px;
  width: 100%;
  border: none;
  border-radius: var(--radius);
  font-weight: 600;
  background: linear-gradient(135deg, var(--primary), var(--accent));
  color: white;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 0.95rem;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
}

:global(.save-bio-btn:hover) {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
}

/* === MODALES MEJORADOS === */
:global(.modal) {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  backdrop-filter: blur(6px);
}

:global(.modal.hidden) {
  display: none;
}

:global(.modal-content) {
  background: var(--card-bg);
  border-radius: var(--radius);
  padding: 35px;
  max-width: 650px;
  width: 90%;
  max-height: 85vh;
  overflow-y: auto;
  box-shadow: var(--shadow-lg);
  position: relative;
  animation: modalSlideIn 0.3s ease;
}

:global(.modal-content h2) {
  color: var(--primary-dark);
  margin-bottom: 24px;
  font-size: 1.6rem;
  border-bottom: 3px solid var(--primary);
  padding-bottom: 12px;
  font-weight: 600;
}

:global(.close-modal) {
  position: absolute;
  top: 18px;
  right: 18px;
  background: transparent;
  border: none;
  font-size: 2rem;
  cursor: pointer;
  color: var(--text-dark);
  transition: all 0.3s ease;
  width: 42px;
  height: 42px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  font-weight: 300;
}

:global(.close-modal:hover) {
  background: var(--primary);
  color: white;
  transform: rotate(90deg);
}

/* === BOTONES DEL MODAL === */
:global(.modal-options) {
  display: flex;
  flex-direction: column;
  gap: 14px;
  margin-bottom: 24px;
}

:global(.modal-btn) {
  padding: 13px 22px;
  border: 2px solid var(--primary);
  background: white;
  color: var(--primary);
  border-radius: var(--radius);
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: left;
  font-size: 0.95rem;
}

:global(.modal-btn:hover) {
  background: var(--primary);
  color: white;
  transform: translateX(8px);
  box-shadow: 0 3px 10px rgba(104, 116, 80, 0.3);
}

:global(.modal-btn.confirm) {
  background: var(--primary);
  color: white;
  border: none;
  text-align: center;
  box-shadow: 0 3px 10px rgba(104, 116, 80, 0.3);
}

:global(.modal-btn.confirm:hover) {
  background: var(--primary-dark);
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(104, 116, 80, 0.4);
}

#urlForm,
#bannerUrlForm {
  display: flex;
  flex-direction: column;
  gap: 14px;
  margin-top: 18px;
}

#urlForm input,
#bannerUrlForm input {
  padding: 13px 15px;
  border: 2px solid var(--border-color);
  border-radius: var(--radius);
  font-size: 1rem;
  transition: all 0.3s ease;
}

#urlForm input:focus,
#bannerUrlForm input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(104, 116, 80, 0.15);
}

/* === ITEMS DE MODALES === */
.follower-item,
.like-item,
:global(.post-item) {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 16px;
  border-radius: var(--radius);
  margin-bottom: 12px;
  background: var(--bg-light);
  transition: all 0.3s ease;
  cursor: pointer;
  border: 2px solid transparent;
}

:global(.follower-item:hover),
.like-item:hover,
:global(.post-item:hover) {
  background: white;
  border-color: var(--primary);
  transform: translateX(8px);
  box-shadow: var(--shadow-sm);
}

:global(.follower-item img),
.like-item img,
:global(.post-item img) {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid var(--primary);
  flex-shrink: 0;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

:global(.follower-item span) {
  font-weight: 600;
  color: var(--text-dark);
  font-size: 1rem;
}

.like-item div,
.post-item div {
  flex: 1;
  min-width: 0;
}

:global(.like-item p),
:global(.post-item p) {
  margin: 0 0 8px 0;
  color: var(--text-dark);
  font-weight: 500;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  font-size: 0.95rem;
}

:global(.like-item span) {
  font-size: 0.85rem;
  color: #666;
}

:global(.post-stats) {
  display: flex;
  gap: 18px;
  margin-top: 10px;
  font-size: 0.9rem;
  color: #666;
  flex-wrap: wrap;
}

:global(.post-stats span) {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-weight: 500;
}

:global(.like-item small) {
  display: block;
  margin-top: 8px;
  color: var(--primary);
  font-size: 0.85rem;
  font-weight: 500;
}

:global(.no-image) {
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, var(--secondary), var(--accent));
  border-radius: 50%;
  font-size: 1.8rem;
  flex-shrink: 0;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

/* === MENSAJES VAC√çOS === */
.followers-list p,
:global(.likes-list )p,
.posts-list p {
  text-align: center;
  color: #999;
  padding: 50px 20px;
  font-style: italic;
  font-size: 1.05rem;
}

/* === SCROLLBARS PERSONALIZADAS === */
:global(.modal-content::-webkit-scrollbar),
:global(.search-results::-webkit-scrollbar) {
  width: 10px;
}

.modal-content::-webkit-scrollbar-track,
:global(.search-results::-webkit-scrollbar-track) {
  background: var(--bg-light);
  border-radius: 10px;
}

.modal-content::-webkit-scrollbar-thumb,
:global(.search-results::-webkit-scrollbar-thumb) {
  background: var(--primary);
  border-radius: 10px;
  border: 2px solid var(--bg-light);
}

.modal-content::-webkit-scrollbar-thumb:hover,
:global(.search-results::-webkit-scrollbar-thumb:hover) {
  background: var(--primary-dark);
}

/* === NOTIFICACIONES === */
:global(.notification) {
  position: fixed;
  top: 28px;
  right: 28px;
  padding: 16px 26px;
  border-radius: var(--radius);
  color: white;
  font-weight: 600;
  z-index: 99999;
  animation: slideIn 0.4s ease;
  box-shadow: var(--shadow-lg);
  font-size: 0.95rem;
  max-width: 400px;
  border: 2px solid rgba(255, 255, 255, 0.3);
}

:global(.notification.success) {
  background: linear-gradient(135deg, var(--primary), var(--accent));
}

:global(.notification.error) {
  background: linear-gradient(135deg, #d32f2f, #b71c1c);
}

:global(.notification.hidden) {
  display: none;
}

/* === RESPONSIVE DESIGN === */
@media (max-width: 1200px) {
  .profile-container {
    grid-template-columns: 1fr 1.5fr 1fr;
  }
}

@media (max-width: 992px) {
  .profile-container {
    grid-template-columns: 1fr;
    margin-top: 70px;
    gap: 20px;
    padding: 20px;
  }

  .left-section,
  .right-section {
    position: static;
  }

  :global(.search-results) {
    width: calc(100% - 40px);
  }

  :global(.modal-content) {
    width: 95%;
    padding: 25px;
    max-height: 90vh;
  }

  .banner {
    height: 200px;
  }

  .change-banner-btn {
    padding: 10px 16px;
    font-size: 0.9rem;
    bottom: 14px;
    right: 14px;
  }

  .group-actions {
    flex-direction: column;
  }

  :global(.group-actions .modal-btn) {
    width: 100%;
    min-width: auto;
  }

  .group-stats {
    gap: 30px;
    padding: 20px;
  }

  .members-grid {
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
  }
}

@media (max-width: 768px) {
  .profile-container {
    padding: 16px;
    margin-top: 60px;
  }

  .profile-image {
    width: 130px;
    height: 130px;
  }

  :global(.modal-content h2) {
    font-size: 1.3rem;
  }

  .follower-item img,
  .like-item img,
  .post-item img,
  .no-image {
    width: 50px;
    height: 50px;
  }

  .banner {
    height: 170px;
  }

  .change-banner-btn {
    bottom: 12px;
    right: 12px;
    padding: 8px 14px;
    font-size: 0.85rem;
  }

  .members-grid {
    grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
    gap: 14px;
  }

  .member-item img {
    width: 50px;
    height: 50px;
  }

  .group-stats {
    flex-direction: column;
    gap: 20px;
  }
}

@media (max-width: 576px) {
  .profile-container {
    padding: 12px;
  }

  .profile-image {
    width: 110px;
    height: 110px;
  }

  .left-section,
  .right-section,
  .main-section {
    padding: 20px;
  }

  :global(.modal-content) {
    padding: 20px;
  }

  :global(.modal-content h2) {
    font-size: 1.2rem;
    padding-bottom: 10px;
  }

  .follower-item img,
  .like-item img,
  .post-item img,
  .no-image {
    width: 45px;
    height: 45px;
  }

  .banner {
    height: 140px;
  }

  .change-banner-btn {
    bottom: 10px;
    right: 10px;
    padding: 7px 12px;
    font-size: 0.8rem;
  }

  .members-grid {
    grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
    gap: 12px;
  }

  .member-item {
    padding: 8px;
  }

  .member-item img {
    width: 45px;
    height: 45px;
  }

  .notification {
    top: 15px;
    right: 15px;
    left: 15px;
    max-width: none;
    padding: 14px 20px;
  }

  :global(.search-result-item) {
    padding: 12px;
  }

  :global(.search-result-item img) {
    width: 45px;
    height: 45px;
  }

  .group-small-image,
  :global(.group-icon) {
    width: 48px;
    height: 48px;
  }

  .user-stats {
    padding: 14px;
  }

  .user-stats p {
    padding: 8px 10px;
    font-size: 0.9rem;
  }
}

@media (max-width: 400px) {
  .profile-image {
    width: 100px;
    height: 100px;
  }

  .banner {
    height: 120px;
  }

  .modal-content {
    padding: 18px;
  }

  .group-card-small {
    padding: 12px;
  }

  .team-card {
    padding: 20px;
  }

  .members-grid {
    grid-template-columns: repeat(auto-fill, minmax(55px, 1fr));
  }
}

/* === ACCESIBILIDAD / REDUCIR MOVIMIENTO === */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* === MODO OSCURO === */
@media (prefers-color-scheme: dark) {
  :root {
    --card-bg: #2a2e27;
    --text-dark: #e6e9e3;
    --bg-light: #1a1d18;
    --border-color: #4e5748;
  }

  :global(.search-results),
  .modal-content {
    background: var(--card-bg);
    color: var(--text-dark);
  }

  :global(.search-result-item:hover),
  .follower-item:hover,
  .like-item:hover,
  .post-item:hover {
    background: #353933;
  }

  .group-card-small {
    background: var(--card-bg);
    border-color: var(--border-color);
  }

  .group-card-small:hover {
    background: #353933;
  }

  .form-group input,
  .form-group textarea {
    background: #353933;
    color: var(--text-dark);
    border-color: var(--border-color);
  }

  .image-preview-btn {
    background: #353933;
    border-color: var(--border-color);
  }

  .image-preview-btn:hover {
    background: var(--card-bg);
  }
}

/* === ESTILOS ADICIONALES DE EXPERIENCIA === */
img {
  image-rendering: -webkit-optimize-contrast;
}

.team-card p,
.team-card h4 {
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

button:focus-visible,
input:focus-visible,
textarea:focus-visible,
select:focus-visible {
  outline: 3px solid var(--accent);
  outline-offset: 2px;
}

html {
  scroll-behavior: smooth;
}

button {
  user-select: none;
  -webkit-user-select: none;
}

button:disabled,
input:disabled,
textarea:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.user-stats p span,
.team-action-btn,
.view-group-btn,
:global(.modal-btn) {
  will-change: transform;
}

.profile-image,
:global(.banner-image),
.group-small-image,
.member-item img {
  will-change: transform;
  backface-visibility: hidden;
}

.member-badge {
  display: inline-block;
  background: linear-gradient(90deg, #72B340, #8BC34A);
  color: white;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 600;
  margin-left: 8px;
}

.status-indicator {
  display: inline-block;
  padding: 2px 6px;
  border-radius: 8px;
  font-size: 0.7rem;
  margin-left: 4px;
}

.status-online { background: #4ade80; color: white; }
.status-away { background: #fbbf24; color: white; }
.status-busy { background: #f87171; color: white; }
.status-offline { background: #9ca3af; color: white; }

.no-groups, .no-members {
  text-align: center;
  color: #999;
  padding: 20px;
  font-style: italic;
}

.more-members {
  text-align: center;
  color: #666;
  margin-top: 10px;
  font-size: 0.9rem;
}

.delete-btn {
  background: linear-gradient(90deg, #ef4444, #dc2626) !important;
}

.delete-btn:hover {
  background: linear-gradient(90deg, #dc2626, #b91c1c) !important;
}
</style>