---
// src/pages/Explore.astro
import Layout from '../layouts/Layout.astro';
import Navigation from '../components/shared/Navigation.astro';
---

<Layout title="Explorar">
  <Navigation />

  <div class="explore-container">
    <div class="explore-header">
      <h1>üîç Explorar</h1>
      <div class="search-bar-large">
        <svg class="search-icon" viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"/>
          <path d="M21 21l-4.35-4.35"/>
        </svg>
        <input 
          type="text" 
          id="explore-search" 
          placeholder="Buscar personas, hashtags, lugares..." 
        />
        <div id="search-results" class="search-results"></div>
      </div>
    </div>

    <div class="explore-tabs">
      <button class="explore-tab active" data-tab="trending">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
          <polyline points="17 6 23 6 23 12"/>
        </svg>
        Tendencias
      </button>
      <button class="explore-tab" data-tab="people">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
          <path d="M23 21v-2a4 4 0 00-3-3.87"/>
          <path d="M16 3.13a4 4 0 010 7.75"/>
        </svg>
        Personas
      </button>
      <button class="explore-tab" data-tab="stories">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <circle cx="12" cy="12" r="3"/>
        </svg>
        Historias
      </button>
      <button class="explore-tab" data-tab="groups">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2"/>
          <path d="M9 3v18"/>
        </svg>
        Grupos
      </button>
    </div>

    <div id="explore-content" class="explore-content">
      
      <!-- üî• TRENDING POSTS -->
      <div id="trending-section" class="content-section">
        <div class="section-header">
          <h2>üî• Publicaciones Populares</h2>
          <select id="trending-filter" class="filter-select">
            <option value="today">Hoy</option>
            <option value="week">Esta semana</option>
            <option value="month">Este mes</option>
            <option value="all">Todo el tiempo</option>
          </select>
        </div>
        <div id="posts-grid" class="posts-masonry">
          <div class="loading-grid">
            <div class="spinner"></div>
            <p>Cargando publicaciones...</p>
          </div>
        </div>
      </div>

      <!-- üë• PERSONAS -->
      <div id="people-section" class="content-section hidden">
        <div class="section-header">
          <h2>üë• Sugerencias para ti</h2>
          <button id="refresh-suggestions" class="refresh-btn">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
            </svg>
          </button>
        </div>
        <div id="people-grid" class="people-grid"></div>
      </div>

      <!-- üìñ HISTORIAS ACTIVAS -->
      <div id="stories-section" class="content-section hidden">
        <div class="section-header">
          <h2>üìñ Historias Activas (√∫ltimas 24h)</h2>
        </div>
        <div id="stories-grid" class="stories-grid"></div>
      </div>

      <!-- üë• GRUPOS -->
      <div id="groups-section" class="content-section hidden">
        <div class="section-header">
          <h2>üë• Grupos Populares</h2>
          <button id="create-group-btn" class="create-btn">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"/>
              <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            Crear Grupo
          </button>
        </div>
        <div id="groups-grid" class="groups-grid"></div>
      </div>

    </div>
  </div>
</Layout>

<script>
  const API_URL = "http://localhost:3000";
  let currentTab = "trending";
  let followingUsers = new Set();

  // ============================================================
  // üî• CARGAR PUBLICACIONES TRENDING
  // ============================================================
  async function loadTrending(filter = "today") {
    const grid = document.getElementById("posts-grid");
    grid.innerHTML = `<div class="loading-grid"><div class="spinner"></div><p>Cargando publicaciones...</p></div>`;

    try {
      const res = await fetch(`${API_URL}/api/explore/trending?filter=${filter}`, {
        credentials: "include",
      });
      if (!res.ok) throw new Error("Error al obtener tendencias");

      const posts = await res.json();
      if (!posts.length) {
        grid.innerHTML = `
          <div class="empty-state">
            <svg viewBox="0 0 24 24" width="64" height="64" fill="none" stroke="currentColor" stroke-width="1.5">
              <rect x="3" y="3" width="18" height="18" rx="2"/>
              <circle cx="8.5" cy="8.5" r="1.5"/>
              <polyline points="21 15 16 10 5 21"/>
            </svg>
            <h3>No hay publicaciones populares</h3>
            <p>S√© el primero en crear contenido viral</p>
          </div>
        `;
        return;
      }

      grid.innerHTML = posts
        .map(
          (post) => `
        <div class="masonry-item" onclick="window.location.href='/Post/${post._id}'">
          <img src="${post.images?.[0] || '/placeholder.jpg'}" alt="Post" loading="lazy" />
          <div class="masonry-overlay">
            <div class="post-author">
              <img src="${post.author?.profilePic || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(post.author?.username || 'User')}" />
              <span>@${post.author?.username || 'usuario'}</span>
            </div>
            <div class="overlay-stats">
              <span>
                <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                  <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                </svg>
                ${formatNumber(post.likes?.length || 0)}
              </span>
              <span>
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>
                </svg>
                ${formatNumber(post.comments?.length || 0)}
              </span>
            </div>
            ${
              post.caption
                ? `<p class="overlay-caption">${truncate(post.caption, 60)}</p>`
                : ""
            }
          </div>
        </div>`
        )
        .join("");
    } catch (err) {
      console.error("‚ùå Error cargando tendencias:", err);
      grid.innerHTML = `
        <div class="empty-state error">
          <svg viewBox="0 0 24 24" width="64" height="64" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="12"/>
            <line x1="12" y1="16" x2="12.01" y2="16"/>
          </svg>
          <h3>Error al cargar publicaciones</h3>
          <p>Intenta nuevamente en unos momentos</p>
        </div>
      `;
    }
  }

  // ============================================================
  // üë• CARGAR SUGERENCIAS DE PERSONAS
  // ============================================================
  async function loadPeople() {
    const grid = document.getElementById("people-grid");
    grid.innerHTML = `<div class="loading-grid"><div class="spinner"></div><p>Buscando personas...</p></div>`;

    try {
      const res = await fetch(`${API_URL}/api/users/suggestions`, { 
        credentials: "include" 
      });
      if (!res.ok) throw new Error("Error al cargar personas");
      const users = await res.json();

      if (!users.length) {
        grid.innerHTML = `
          <div class="empty-state">
            <svg viewBox="0 0 24 24" width="64" height="64" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M23 21v-2a4 4 0 00-3-3.87"/>
              <path d="M16 3.13a4 4 0 010 7.75"/>
            </svg>
            <h3>No hay sugerencias disponibles</h3>
            <p>Ya sigues a todos los usuarios activos</p>
          </div>
        `;
        return;
      }

      grid.innerHTML = users
        .map(
          (user) => `
        <div class="user-card">
          <div class="user-card-header">
            <img src="${
              user.profilePic ||
              `https://ui-avatars.com/api/?name=${encodeURIComponent(user.username)}&background=687450&color=fff`
            }" alt="${user.username}" class="user-card-avatar" onclick="window.location.href='/Profile/${user._id}'" />
            ${user.isVerified ? '<span class="verified-badge">‚úì</span>' : ''}
          </div>
          <div class="user-card-info" onclick="window.location.href='/Profile/${user._id}'">
            <h3>@${user.username}</h3>
            <p>${user.bio || "Sin biograf√≠a"}</p>
            <div class="user-stats">
              <span><strong>${formatNumber(user.followersCount || 0)}</strong> seguidores</span>
              <span><strong>${formatNumber(user.postsCount || 0)}</strong> posts</span>
            </div>
          </div>
          <button class="follow-user-btn" data-user-id="${user._id}">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
              <circle cx="8.5" cy="7" r="4"/>
              <line x1="20" y1="8" x2="20" y2="14"/>
              <line x1="23" y1="11" x2="17" y2="11"/>
            </svg>
            Seguir
          </button>
        </div>`
        )
        .join("");

      // Listeners para seguir
      grid.querySelectorAll(".follow-user-btn").forEach((btn) => {
        btn.addEventListener("click", async (e) => {
          e.stopPropagation();
          const userId = btn.dataset.userId;
          
          try {
            btn.disabled = true;
            const followRes = await fetch(`${API_URL}/api/users/${userId}/follow`, {
              method: "POST",
              credentials: "include",
            });
            
            if (followRes.ok) {
              followingUsers.add(userId);
              btn.innerHTML = `
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                  <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                Siguiendo
              `;
              btn.classList.add("following");
            }
          } catch (err) {
            console.error("‚ùå Error al seguir:", err);
            btn.disabled = false;
          }
        });
      });
    } catch (err) {
      console.error("‚ùå Error al cargar personas:", err);
      grid.innerHTML = `
        <div class="empty-state error">
          <h3>Error al cargar usuarios</h3>
          <p>Intenta nuevamente</p>
        </div>
      `;
    }
  }

  // ============================================================
  // üìñ CARGAR HISTORIAS ACTIVAS
  // ============================================================
  async function loadStories() {
    const grid = document.getElementById("stories-grid");
    grid.innerHTML = `<div class="loading-grid"><div class="spinner"></div><p>Cargando historias...</p></div>`;

    try {
      const res = await fetch(`${API_URL}/api/stories`, { credentials: "include" });
      if (!res.ok) throw new Error("Error al cargar historias");
      const stories = await res.json();

      // Agrupar por autor
      const grouped = {};
      stories.forEach(s => {
        const id = s.author._id;
        if (!grouped[id]) grouped[id] = { user: s.author, stories: [], lastStory: s };
        grouped[id].stories.push(s);
      });

      const groupsArray = Object.values(grouped);

      if (!groupsArray.length) {
        grid.innerHTML = `
          <div class="empty-state">
            <svg viewBox="0 0 24 24" width="64" height="64" fill="none" stroke="currentColor" stroke-width="1.5">
              <circle cx="12" cy="12" r="10"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
            <h3>No hay historias activas</h3>
            <p>Las historias desaparecen despu√©s de 24 horas</p>
          </div>
        `;
        return;
      }

      grid.innerHTML = groupsArray
        .map(g => `
          <div class="story-card" data-user-id="${g.user._id}">
            <div class="story-card-ring">
              <img src="${g.user.profilePic || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(g.user.username)}" />
            </div>
            <div class="story-card-info">
              <h4>@${g.user.username}</h4>
              <span>${g.stories.length} historia${g.stories.length > 1 ? 's' : ''}</span>
              <small>${formatTime(g.lastStory.createdAt)}</small>
            </div>
          </div>
        `)
        .join("");

      // Click handlers
      grid.querySelectorAll(".story-card").forEach(card => {
        card.addEventListener("click", () => {
          const userId = card.dataset.userId;
          const group = grouped[userId];
          if (group) {
            // Aqu√≠ se deber√≠a abrir el visor de historias
            console.log("Abrir historias de:", group.user.username, group.stories);
          }
        });
      });

    } catch (err) {
      console.error("‚ùå Error cargando historias:", err);
      grid.innerHTML = `<div class="empty-state error"><h3>Error al cargar historias</h3></div>`;
    }
  }

  // ============================================================
  // üë• CARGAR GRUPOS
  // ============================================================
  async function loadGroups() {
    const grid = document.getElementById("groups-grid");
    grid.innerHTML = `<div class="loading-grid"><div class="spinner"></div><p>Cargando grupos...</p></div>`;

    try {
      const res = await fetch(`${API_URL}/api/groups`, { credentials: "include" });
      if (!res.ok) throw new Error("Error al cargar grupos");
      const groups = await res.json();

      if (!groups.length) {
        grid.innerHTML = `
          <div class="empty-state">
            <svg viewBox="0 0 24 24" width="64" height="64" fill="none" stroke="currentColor" stroke-width="1.5">
              <rect x="3" y="3" width="18" height="18" rx="2"/>
              <path d="M9 3v18"/>
            </svg>
            <h3>No hay grupos disponibles</h3>
            <p>Crea el primer grupo de la comunidad</p>
          </div>
        `;
        return;
      }

      grid.innerHTML = groups
        .map(group => `
          <div class="group-card" onclick="window.location.href='/Group/${group.slug}'">
            <div class="group-banner" style="background: linear-gradient(135deg, #425638 0%, #687450 100%);">
              ${group.banner ? `<img src="${group.banner}" alt="${group.name}" />` : ''}
            </div>
            <div class="group-content">
              <img src="${group.icon || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(group.name) + '&background=687450&color=fff'}" class="group-icon" />
              <h3>${group.name}</h3>
              <p>${group.description || 'Sin descripci√≥n'}</p>
              <div class="group-stats">
                <span>üë• ${formatNumber(group.membersCount || 0)} miembros</span>
                <span>üìù ${formatNumber(group.postsCount || 0)} posts</span>
              </div>
              <span class="group-privacy">${group.privacy === 'private' ? 'üîí Privado' : 'üåç P√∫blico'}</span>
            </div>
          </div>
        `)
        .join("");

    } catch (err) {
      console.error("‚ùå Error cargando grupos:", err);
      grid.innerHTML = `<div class="empty-state error"><h3>Error al cargar grupos</h3></div>`;
    }
  }

  // ============================================================
  // üîç B√öSQUEDA GLOBAL
  // ============================================================
  let searchTimeout;
  const searchInput = document.getElementById("explore-search");
  const searchResults = document.getElementById("search-results");

  searchInput?.addEventListener("input", (e) => {
    clearTimeout(searchTimeout);
    const query = e.target.value.trim();
    
    if (query.length < 2) {
      searchResults.innerHTML = "";
      searchResults.classList.remove("active");
      return;
    }

    searchTimeout = setTimeout(async () => {
      try {
        const res = await fetch(`${API_URL}/api/users/search?q=${encodeURIComponent(query)}`, {
          credentials: "include",
        });
        const users = await res.json();
        
        if (users.length === 0) {
          searchResults.innerHTML = `<div class="search-empty">Sin resultados para "${query}"</div>`;
        } else {
          searchResults.innerHTML = users.slice(0, 5).map(user => `
            <div class="search-result-item" onclick="window.location.href='/Profile/${user._id}'">
              <img src="${user.profilePic || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(user.username)}" />
              <div class="search-result-info">
                <strong>@${user.username}</strong>
                <span>${user.bio || 'Sin biograf√≠a'}</span>
              </div>
            </div>
          `).join("");
        }
        
        searchResults.classList.add("active");
      } catch (err) {
        console.error("‚ùå Error en b√∫squeda:", err);
      }
    }, 300);
  });

  // Cerrar resultados al hacer clic fuera
  document.addEventListener("click", (e) => {
    if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
      searchResults.classList.remove("active");
    }
  });

  // ============================================================
  // üß≠ MANEJO DE TABS
  // ============================================================
  document.querySelectorAll(".explore-tab").forEach((tab) => {
    tab.addEventListener("click", () => {
      document.querySelectorAll(".explore-tab").forEach((t) => t.classList.remove("active"));
      tab.classList.add("active");
      const tabName = tab.dataset.tab;
      currentTab = tabName;

      document.querySelectorAll(".content-section").forEach((s) => s.classList.add("hidden"));
      const section = document.getElementById(`${tabName}-section`);
      section?.classList.remove("hidden");

      switch (tabName) {
        case "trending":
          loadTrending();
          break;
        case "people":
          loadPeople();
          break;
        case "stories":
          loadStories();
          break;
        case "groups":
          loadGroups();
          break;
      }
    });
  });

  // ============================================================
  // üîÑ REFRESH SUGGESTIONS
  // ============================================================
  document.getElementById("refresh-suggestions")?.addEventListener("click", () => {
    loadPeople();
  });

  // ============================================================
  // üé® FILTER TRENDING
  // ============================================================
  document.getElementById("trending-filter")?.addEventListener("change", (e) => {
    loadTrending(e.target.value);
  });

  // ============================================================
  // ‚öôÔ∏è UTILIDADES
  // ============================================================
  function formatNumber(num) {
    if (!num) return 0;
    if (num >= 1_000_000) return (num / 1_000_000).toFixed(1) + "M";
    if (num >= 1_000) return (num / 1_000).toFixed(1) + "K";
    return num;
  }

  function truncate(text, length) {
    return text?.length > length ? text.substring(0, length) + "..." : text;
  }

  function formatTime(timestamp) {
    const now = new Date();
    const then = new Date(timestamp);
    const diff = Math.floor((now - then) / 1000);

    if (diff < 60) return 'Hace un momento';
    if (diff < 3600) return `Hace ${Math.floor(diff / 60)}m`;
    if (diff < 86400) return `Hace ${Math.floor(diff / 3600)}h`;
    return `Hace ${Math.floor(diff / 86400)}d`;
  }

  // ============================================================
  // üöÄ INICIALIZAR
  // ============================================================
  document.addEventListener("DOMContentLoaded", () => {
    loadTrending();
  });
</script>

<style>
  :global(:root) {
    --primary: #425638;
    --primary-light: #54704a;
    --primary-dark: #334429;
    --secondary: #687450;
    --secondary-light: #7d8a65;
    --secondary-dark: #54603f;
    --dark: #1a1a1a;
    --dark-medium: #2d2d2d;
    --gray: #6b7280;
    --gray-medium: #9ca3af;
    --gray-light: #f3f4f6;
    --gray-lighter: #f9fafb;
    --border: #e5e7eb;
    --border-light: #f0f0f0;
    --card-bg: #ffffff;
    --shadow-xs: 0 1px 3px rgba(66, 86, 56, 0.06);
    --shadow-sm: 0 2px 8px rgba(66, 86, 56, 0.08);
    --shadow-md: 0 4px 16px rgba(66, 86, 56, 0.12);
    --shadow-lg: 0 8px 24px rgba(66, 86, 56, 0.15);
    --shadow-xl: 0 12px 32px rgba(66, 86, 56, 0.18);
    --radius-sm: 10px;
    --radius: 16px;
    --radius-lg: 20px;
    --radius-xl: 24px;
    --gradient: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    --gradient-overlay: linear-gradient(to bottom, rgba(66,86,56,0.1) 0%, rgba(0,0,0,0.85) 100%);
    --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  :global(*) {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  :global(body) {
    background: var(--gray-lighter);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  }

  :global(.explore-container) {
    max-width: 1400px;
    margin: 90px auto 40px;
    padding: 0 32px;
    background-color: var(--secondary);
  }

  :global(.explore-header) {
    margin-bottom: 40px;
  }

  :global(.explore-header h1) {
    font-size: 36px;
    font-weight: 800;
    background: var(--gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 24px;
  }

  :global(.search-bar-large) {
    position: relative;
    max-width: 600px;
  }

  :global(.search-icon) {
    position: absolute;
    left: 24px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray);
    z-index: 2;
  }

  :global(#explore-search) {
    width: 100%;
    padding: 18px 24px 18px 60px;
    border: 2px solid var(--border);
    border-radius: 50px;
    font-size: 16px;
    background: white;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  :global(#explore-search:focus) {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(66, 86, 56, 0.1);
  }

  :global(.search-results) {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    right: 0;
    background: white;
    border-radius: var(--radius);
    box-shadow: var(--shadow-lg);
    max-height: 400px;
    overflow-y: auto;
    display: none;
    z-index: 100;
  }

  :global(.search-results.active) {
    display: block;
  }

  :global(.search-result-item) {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    cursor: pointer;
    transition: background 0.2s;
  }

  :global(.search-result-item:hover) {
    background: var(--gray-light);
  }

  :global(.search-result-item img) {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    object-fit: cover;
  }

  :global(.search-result-info) {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  :global(.search-result-info strong) {
    color: var(--dark);
    font-size: 14px;
  }

  :global(.search-result-info span) {
    color: var(--gray);
    font-size: 13px;
  }

  :global(.search-empty) {
    padding: 24px;
    text-align: center;
    color: var(--gray);
  }

  :global(.explore-tabs) {
    display: flex;
    gap: 12px;
    margin-bottom: 40px;
    overflow-x: auto;
    scrollbar-width: none;
    padding-bottom: 8px;
  }

  :global(.explore-tabs::-webkit-scrollbar) {
    display: none;
  }

  :global(.explore-tab) {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 14px 24px;
    background: white;
    border: 2px solid var(--border);
    border-radius: 50px;
    font-size: 15px;
    font-weight: 600;
    color: var(--gray);
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.3s;
  }

  :global(.explore-tab:hover) {
    border-color: var(--primary);
    color: var(--dark);
    transform: translateY(-2px);
  }

  :global(.explore-tab.active) {
    background: var(--gradient);
    border-color: transparent;
    color: white;
    box-shadow: var(--shadow-md);
  }

  :global(.content-section) {
    animation: fadeIn 0.5s ease;
  }

  :global(.content-section.hidden) {
    display: none;
  }

  :global(.section-header) {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 28px;
  }

  :global(.section-header h2) {
    font-size: 24px;
    font-weight: 700;
    color: var(--dark);
  }

  :global(.filter-select),
  :global(.refresh-btn),
  :global(.create-btn) {
    padding: 10px 18px;
    border: 2px solid var(--border);
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    background: white;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  :global(.filter-select:hover),
  :global(.refresh-btn:hover),
  :global(.create-btn:hover) {
    border-color: var(--primary);
    color: var(--primary);
  }

  :global(.posts-masonry) {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 24px;
  }

  :global(.masonry-item) {
    position: relative;
    aspect-ratio: 1;
    border-radius: var(--radius);
    overflow: hidden;
    cursor: pointer;
    transition: var(--transition);
    box-shadow: var(--shadow-sm);
  }

  :global(.masonry-item:hover) {
    transform: scale(1.05);
    box-shadow: var(--shadow-lg);
  }

  :global(.masonry-item img) {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  :global(.masonry-overlay) {
    position: absolute;
    inset: 0;
    background: var(--gradient-overlay);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    opacity: 0;
    transition: opacity 0.3s;
    padding: 20px;
  }

  :global(.masonry-item:hover .masonry-overlay) {
    opacity: 1;
  }

  :global(.post-author) {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  :global(.post-author img) {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 2px solid white;
  }

  :global(.post-author span) {
    color: white;
    font-weight: 600;
    font-size: 14px;
  }

  :global(.overlay-stats) {
    display: flex;
    gap: 20px;
  }

  :global(.overlay-stats span) {
    display: flex;
    align-items: center;
    gap: 8px;
    color: white;
    font-weight: 600;
    font-size: 15px;
  }

  :global(.overlay-caption) {
    color: white;
    font-size: 14px;
  }

  :global(.people-grid) {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 24px;
  }

  :global(.user-card) {
    background: white;
    border-radius: var(--radius);
    padding: 28px;
    box-shadow: var(--shadow-sm);
    text-align: center;
    transition: var(--transition);
    position: relative;
  }

  :global(.user-card:hover) {
    box-shadow: var(--shadow-lg);
    transform: translateY(-8px);
  }

  :global(.stories-grid),
  :global(.groups-grid) {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
    gap: 24px;
  }

  @global keyframes fadeIn {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
