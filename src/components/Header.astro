---
import { onMount } from 'astro/jsx-runtime';

// Definimos si el usuario est√° autenticado
let isAuthenticated = false;

// Verificamos si hay una sesi√≥n activa en el backend
try {
  const res = await fetch('http://localhost:3000/auth/status', {
    credentials: 'include',
  });
  const data = await res.json();
  isAuthenticated = data.loggedIn;
} catch (error) {
  console.error('Error verificando sesi√≥n:', error);
}
---

<header id="header-nav" class="fixed w-screen py-1 z-40 top-0 px-8 lg:px-0">
  <div class="grid grid-cols-3 max-w-7xl mx-auto items-center justify-between">
    <!-- üîπ Logo -->
    <a href="/" class="col-span-1">
      <img class="w-auto mx-20" src="src/img/Robot Icon.png" alt="Logo Bot" />
    </a>

    <!-- üîπ Navegaci√≥n din√°mica -->
    <nav class="col-span-1 justify-self-center">
      <ul class="flex gap-4 items-center text-white font-medium">
        {
          isAuthenticated
            ? (
              <>
                <li><a class="hover:underline" href="/Music">üéµ Music</a></li>
                <li><a class="hover:underline" href="/Food">üçΩÔ∏è Food Section</a></li>
                <li><a class="hover:underline" href="/Books">üìö Book Section</a></li>
                <li><a class="hover:underline" href="/Chatbot">ü§ñ Chatbot</a></li>
              </>
            )
            : (
              <>
                <li><a class="hover:underline" href="/Social">Social</a></li>
                <li><a class="hover:underline" href="/Testimonials">Testimonials</a></li>
                <li><a class="hover:underline" href="/FAQ">FAQ</a></li>
                <li><a class="hover:underline" href="/Contact">Contact</a></li>
              </>
            )
        }
      </ul>
    </nav>

    <!-- üîπ Bot√≥n derecho -->
    {
      isAuthenticated
        ? (
          <button
            id="logout-btn"
            class="border rounded-full inline-block border-white px-4 py-2 justify-self-end hover:bg-white hover:text-black duration-300"
          >
            Logout
          </button>
        )
        : (
          <a
            id="header-vip"
            href="/Register"
            class="border rounded-full inline-block border-white px-4 py-2 justify-self-end hover:bg-white hover:text-black duration-300"
          >
            Login
          </a>
        )
    }
  </div>

  <!-- üîπ Efecto de scroll -->
  <script>
    window.addEventListener('scroll', function () {
      const header = document.getElementById('header-nav');
      if (header) {
        if (window.scrollY > 50) {
          header.classList.add('fixed-blur');
        } else {
          header.classList.remove('fixed-blur');
        }
      }
    });

    // üîπ Cierre de sesi√≥n sin recargar
    const logoutBtn = document.getElementById('logout-btn');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', async () => {
        try {
          await fetch('http://localhost:3000/logout', {
            method: 'POST',
            credentials: 'include',
          });
          window.location.href = '/';
        } catch (error) {
          alert('Error cerrando sesi√≥n');
        }
      });
    }
  </script>
</header>

<style>
  header {
    background-color: #3b432b;
    color: white;
    transition: all 0.3s ease;
  }

  .fixed-blur {
    backdrop-filter: blur(10px);
    background-color: rgba(59, 67, 43, 0.8);
  }

  .hover\:underline:hover {
    text-decoration: underline;
  }
</style>
